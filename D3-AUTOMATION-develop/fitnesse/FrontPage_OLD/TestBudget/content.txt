!*****> !style_green[10. BUDGET]
!*****> Create Test Data

!|Execute|!-insert into [OLB_TRANSACTION]([ACCOUNT_ID],[INTERFACE_ID],[TYPE],[IDENTIFIER]
      ,[CHECKNUM],[NAME],[MEMO],[AMOUNT],[PRINCIPAL_AMOUNT],[INTEREST_AMOUNT],[POST_DATE]
      ,[OTHER_AMOUNT],[CREATED_DATE],[OFFLINE],[DIRECT_ID],[MCC],[CURRENCY_CODE]
      ,[PENDING],[RUNNING_BALANCE],[ORIGINATION_DATE],[TRAN_CODE]
      ,[POSTING_SEQ],[IMAGE_ID])
       values (1, 2, 0, 1, 105, 'BudgetTestTransaction-1', 'Test Memo', 45.45, 25.14, 45.12, DATEADD(day, -2, SYSDATETIME()), 47.45,
       DATEADD(day, -2, SYSDATETIME()),1, 'FitDirectID1', '100', null, 0, null, DATEADD(day, -2, SYSDATETIME()), null, null, null)	
       insert into [USER_TRANSACTION_JOIN]([TRANSACTION_ID],[USER_ID],[IS_SPLIT],[RENAMED]
      ,[CATEGORIZED],[USER_MEMO],[STATUS])
      values((select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-1'), -!@userID!-, 0, null, null, null, 0)-!||
!|Query|!-SELECT [ID] FROM [OLB_TRANSACTION] WHERE NAME = 'BudgetTestTransaction-1'-!|
| [ID]?|
|>>transactionID1|
!|Query|!-SELECT ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@transactionID1|
| ID?|
|>>userTransactionJoinID|
!|Execute|!-insert into[SPLIT_CATEGORIZATION]([USER_TRANSACTION_JOIN_ID],[CATEGORY_ID],[SPLIT_AMOUNT])
      values(@userTransactionJoinID, 2, 45.45-!)|

!|Execute|!-insert into [OLB_TRANSACTION]([ACCOUNT_ID],[INTERFACE_ID],[TYPE],[IDENTIFIER]
      ,[CHECKNUM],[NAME],[MEMO],[AMOUNT],[PRINCIPAL_AMOUNT],[INTEREST_AMOUNT],[POST_DATE]
      ,[OTHER_AMOUNT],[CREATED_DATE],[OFFLINE],[DIRECT_ID],[MCC],[CURRENCY_CODE]
      ,[PENDING],[RUNNING_BALANCE],[ORIGINATION_DATE],[TRAN_CODE]
      ,[POSTING_SEQ],[IMAGE_ID])
       values (1, 2, 0, 1, 105, 'BudgetTestTransaction-2', 'Test Memo', -!10.00!-, 25.14, 45.12, DATEADD(day, -2, SYSDATETIME()), 47.45,
       DATEADD(day, -2, SYSDATETIME()),1, 'FitDirectID2', '100', null, 0, null, DATEADD(day, -2, SYSDATETIME()), null, null, null)	
       insert into [USER_TRANSACTION_JOIN]([TRANSACTION_ID],[USER_ID],[IS_SPLIT],[RENAMED]
      ,[CATEGORIZED],[USER_MEMO],[STATUS])
      values((select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-2'), -!@userID!-, 0, null, null, null, 0)-!||
!|Query|!-SELECT [ID] FROM [OLB_TRANSACTION] WHERE NAME = 'BudgetTestTransaction-2'-!|
| [ID]?|
|>>transactionID2|
!|Query|!-SELECT ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@transactionID2|
| ID?|
|>>userTransactionJoinID|
!|Execute|!-insert into[SPLIT_CATEGORIZATION]([USER_TRANSACTION_JOIN_ID],[CATEGORY_ID],[SPLIT_AMOUNT])
      values(@userTransactionJoinID, 1, -!10.00)|

!|Execute|!-insert into [OLB_TRANSACTION]([ACCOUNT_ID],[INTERFACE_ID],[TYPE],[IDENTIFIER]
      ,[CHECKNUM],[NAME],[MEMO],[AMOUNT],[PRINCIPAL_AMOUNT],[INTEREST_AMOUNT],[POST_DATE]
      ,[OTHER_AMOUNT],[CREATED_DATE],[OFFLINE],[DIRECT_ID],[MCC],[CURRENCY_CODE]
      ,[PENDING],[RUNNING_BALANCE],[ORIGINATION_DATE],[TRAN_CODE]
      ,[POSTING_SEQ],[IMAGE_ID])
       values (1, 2, 0, 1, 105, 'BudgetTestTransaction-3', 'Test Memo', 78.89, 25.14, 45.12, DATEADD(day, -2, SYSDATETIME()), 47.45,
       DATEADD(day, -2, SYSDATETIME()),1, 'FitDirectID3', '100', null, 0, null, DATEADD(day, -2, SYSDATETIME()), null, null, null)	
       insert into [USER_TRANSACTION_JOIN]([TRANSACTION_ID],[USER_ID],[IS_SPLIT],[RENAMED]
      ,[CATEGORIZED],[USER_MEMO],[STATUS])
      values((select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-3'), -!@userID!-, 0, null, null, null, 0)-!||
!|Query|!-SELECT [ID] FROM [OLB_TRANSACTION] WHERE NAME = 'BudgetTestTransaction-3'-!|
| [ID]?|
|>>transactionID3|
!|Query|!-SELECT ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@transactionID3|
| ID?|
|>>userTransactionJoinID|
!|Execute|!-insert into[SPLIT_CATEGORIZATION]([USER_TRANSACTION_JOIN_ID],[CATEGORY_ID],[SPLIT_AMOUNT])
      values(@userTransactionJoinID, 100, 78.89-!)|

!|Execute|!-insert into [OLB_TRANSACTION]([ACCOUNT_ID],[INTERFACE_ID],[TYPE],[IDENTIFIER]
      ,[CHECKNUM],[NAME],[MEMO],[AMOUNT],[PRINCIPAL_AMOUNT],[INTEREST_AMOUNT],[POST_DATE]
      ,[OTHER_AMOUNT],[CREATED_DATE],[OFFLINE],[DIRECT_ID],[MCC],[CURRENCY_CODE]
      ,[PENDING],[RUNNING_BALANCE],[ORIGINATION_DATE],[TRAN_CODE]
      ,[POSTING_SEQ],[IMAGE_ID])
       values (1, 2, 0, 1, 105, 'BudgetTestTransaction-4', 'Test Memo', 78.45, 25.14, 45.12, DATEADD(day, -2, SYSDATETIME()), 47.45,
       DATEADD(day, -2, SYSDATETIME()),1, 'FitDirectID4', '100', null, 0, null, DATEADD(day, -2, SYSDATETIME()), null, null, null)	
       insert into [USER_TRANSACTION_JOIN]([TRANSACTION_ID],[USER_ID],[IS_SPLIT],[RENAMED]
      ,[CATEGORIZED],[USER_MEMO],[STATUS])
      values((select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-4'), -!@userID!-, 0, null, null, null, 0)-!||
!|Query|!-SELECT [ID] FROM [OLB_TRANSACTION] WHERE NAME = 'BudgetTestTransaction-4'-!|
| [ID]?|
|>>transactionID4|
!|Query|!-SELECT ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@transactionID4|
| ID?|
|>>userTransactionJoinID|
!|Execute|!-insert into[SPLIT_CATEGORIZATION]([USER_TRANSACTION_JOIN_ID],[CATEGORY_ID],[SPLIT_AMOUNT])
      values(@userTransactionJoinID, 101, 78.45-!)|

!|Execute|!-insert into [OLB_TRANSACTION]([ACCOUNT_ID],[INTERFACE_ID],[TYPE],[IDENTIFIER]
      ,[CHECKNUM],[NAME],[MEMO],[AMOUNT],[PRINCIPAL_AMOUNT],[INTEREST_AMOUNT],[POST_DATE]
      ,[OTHER_AMOUNT],[CREATED_DATE],[OFFLINE],[DIRECT_ID],[MCC],[CURRENCY_CODE]
      ,[PENDING],[RUNNING_BALANCE],[ORIGINATION_DATE],[TRAN_CODE]
      ,[POSTING_SEQ],[IMAGE_ID])
       values (1, 2, 0, 1, 105, 'BudgetTestTransaction-5', 'Test Memo', 78.45, 25.14, 45.12, DATEADD(day, -30, SYSDATETIME()), 47.45,
       DATEADD(day, -30, SYSDATETIME()),1, 'FitDirectID5', '100', null, 0, null, DATEADD(day, -30, SYSDATETIME()), null, null, null)	
       insert into [USER_TRANSACTION_JOIN]([TRANSACTION_ID],[USER_ID],[IS_SPLIT],[RENAMED]
      ,[CATEGORIZED],[USER_MEMO],[STATUS])
      values((select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-5'), -!@userID!-, 0, null, null, null, 0)-!||
!|Query|!-SELECT [ID] FROM [OLB_TRANSACTION] WHERE NAME = 'BudgetTestTransaction-5'-!|
| [ID]?|
|>>transactionID5|
!|Query|!-SELECT ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@transactionID5|
| ID?|
|>>userTransactionJoinID|
!|Execute|!-insert into[SPLIT_CATEGORIZATION]([USER_TRANSACTION_JOIN_ID],[CATEGORY_ID],[SPLIT_AMOUNT])
      values(@userTransactionJoinID, 2, 78.45 -!)|

!|Execute|!-insert into [OLB_TRANSACTION]([ACCOUNT_ID],[INTERFACE_ID],[TYPE],[IDENTIFIER]
      ,[CHECKNUM],[NAME],[MEMO],[AMOUNT],[PRINCIPAL_AMOUNT],[INTEREST_AMOUNT],[POST_DATE]
      ,[OTHER_AMOUNT],[CREATED_DATE],[OFFLINE],[DIRECT_ID],[MCC],[CURRENCY_CODE]
      ,[PENDING],[RUNNING_BALANCE],[ORIGINATION_DATE],[TRAN_CODE]
      ,[POSTING_SEQ],[IMAGE_ID])
       values (1, 2, 0, 1, 105, 'BudgetTestTransaction-6', 'Test Memo', 14.23, 25.14, 45.12, DATEADD(day, -30, SYSDATETIME()), 47.45,
       DATEADD(day, -30, SYSDATETIME()),1, 'FitDirectID6', '100', null, 0, null, DATEADD(day, -30, SYSDATETIME()), null, null, null)	
       insert into [USER_TRANSACTION_JOIN]([TRANSACTION_ID],[USER_ID],[IS_SPLIT],[RENAMED]
      ,[CATEGORIZED],[USER_MEMO],[STATUS])
      values((select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-6'), -!@userID!-, 0, null, null, null, 0)-!||
!|Query|!-SELECT [ID] FROM [OLB_TRANSACTION] WHERE NAME = 'BudgetTestTransaction-6'-!|
| [ID]?|
|>>transactionID6|
!|Query|!-SELECT ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@transactionID6|
| ID?|
|>>userTransactionJoinID|
!|Execute|!-insert into[SPLIT_CATEGORIZATION]([USER_TRANSACTION_JOIN_ID],[CATEGORY_ID],[SPLIT_AMOUNT])
      values(@userTransactionJoinID, 1, 14.23-!)|

!|Execute|!-insert into [OLB_TRANSACTION]([ACCOUNT_ID],[INTERFACE_ID],[TYPE],[IDENTIFIER]
      ,[CHECKNUM],[NAME],[MEMO],[AMOUNT],[PRINCIPAL_AMOUNT],[INTEREST_AMOUNT],[POST_DATE]
      ,[OTHER_AMOUNT],[CREATED_DATE],[OFFLINE],[DIRECT_ID],[MCC],[CURRENCY_CODE]
      ,[PENDING],[RUNNING_BALANCE],[ORIGINATION_DATE],[TRAN_CODE]
      ,[POSTING_SEQ],[IMAGE_ID])
       values (1, 2, 0, 1, 105, 'BudgetTestTransaction-7', 'Test Memo', 89.89, 25.14, 45.12, DATEADD(day, -30, SYSDATETIME()), 47.45,
       DATEADD(day, -30, SYSDATETIME()),1, 'FitDirectID7', '100', null, 0, null, DATEADD(day, -30, SYSDATETIME()), null, null, null)	
       insert into [USER_TRANSACTION_JOIN]([TRANSACTION_ID],[USER_ID],[IS_SPLIT],[RENAMED]
      ,[CATEGORIZED],[USER_MEMO],[STATUS])
      values((select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-7'), -!@userID!-, 0, null, null, null, 0)-!||
!|Query|!-SELECT [ID] FROM [OLB_TRANSACTION] WHERE NAME = 'BudgetTestTransaction-7'-!|
| [ID]?|
|>>transactionID7|
!|Query|!-SELECT ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@transactionID7|
| ID?|
|>>userTransactionJoinID|
!|Execute|!-insert into[SPLIT_CATEGORIZATION]([USER_TRANSACTION_JOIN_ID],[CATEGORY_ID],[SPLIT_AMOUNT])
      values(@userTransactionJoinID, 100, 89.89-!)|

!|Execute|!-insert into [OLB_TRANSACTION]([ACCOUNT_ID],[INTERFACE_ID],[TYPE],[IDENTIFIER]
      ,[CHECKNUM],[NAME],[MEMO],[AMOUNT],[PRINCIPAL_AMOUNT],[INTEREST_AMOUNT],[POST_DATE]
      ,[OTHER_AMOUNT],[CREATED_DATE],[OFFLINE],[DIRECT_ID],[MCC],[CURRENCY_CODE]
      ,[PENDING],[RUNNING_BALANCE],[ORIGINATION_DATE],[TRAN_CODE]
      ,[POSTING_SEQ],[IMAGE_ID])
       values (1, 2, 0, 1, 105, 'BudgetTestTransaction-8', 'Test Memo', 14.27, 25.14, 45.12, DATEADD(day, -30, SYSDATETIME()), 47.45,
       DATEADD(day, -30, SYSDATETIME()),1, 'FitDirectID8', '100', null, 0, null, DATEADD(day, -30, SYSDATETIME()), null, null, null)	
       insert into [USER_TRANSACTION_JOIN]([TRANSACTION_ID],[USER_ID],[IS_SPLIT],[RENAMED]
      ,[CATEGORIZED],[USER_MEMO],[STATUS])
      values((select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-8'), -!@userID!-, 0, null, null, null, 0)-!||
!|Query|!-SELECT [ID] FROM [OLB_TRANSACTION] WHERE NAME = 'BudgetTestTransaction-8'-!|
| [ID]?|
|>>transactionID8|
!|Query|!-SELECT ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@transactionID8|
| ID?|
|>>userTransactionJoinID|
!|Execute|!-insert into[SPLIT_CATEGORIZATION]([USER_TRANSACTION_JOIN_ID],[CATEGORY_ID],[SPLIT_AMOUNT])
      values(@userTransactionJoinID, 101, 14.27-!)|

!|Query|!-select SUM(t3.amount) as actualIncomeAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%income%' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualIncomeAmount?|
|>>actualIncomeAmount|
!|Query|!-select SUM(t3.amount) as actualExpenseAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%expense%' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualExpenseAmount?|
|>>actualExpenseAmount|
!|Query|!-select SUM(t3.amount) as actualAmountCategory from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.ID='101' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualAmountCategory?|
|>>actualAmountCategory|
!|Query|!-select SUM(t3.amount) as actualAmountGroup from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_GROUP='Business' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualAmountGroup?|
|>>actualAmountGroup|

!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetExpenseAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%expense%' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetExpenseAmount?|
|>>budgetExpenseAmount|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetIncomeAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%income%' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetIncomeAmount?|
|>>budgetIncomeAmount|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetAmountCategory from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
  t4.ID='101' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetAmountCategory?|
|>>budgetAmountCategory|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetAmountGroup from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
  t4.CATEGORY_GROUP='Business' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetAmountGroup?|
|>>budgetAmountGroup|

!|Query|select @budgetIncomeAmount - @actualIncomeAmount as incomeDifference|
|incomeDifference?|
|>>incomeDifference|
!|Query|select @budgetExpenseAmount - @actualExpenseAmount as expenseDifference|
|expenseDifference?|
|>>expenseDifference|
!|Query|select @actualIncomeAmount- @actualExpenseAmount as actualCashFlow|
|actualCashFlow?|
|>>actualCashFlow|
!|Query|select @budgetIncomeAmount - @budgetExpenseAmount as budgetCashFlow|
|budgetCashFlow?|
|>>budgetCashFlow|
!|Query|select @actualCashFlow - @budgetCashFlow as cashFlowDifference|
|cashFlowDifference?|
|>>cashFlowDifference|
!|Query|select @budgetAmountCategory - @actualAmountCategory as differenceCategory|
|differenceCategory?|
|>>differenceCategory|
!|Query|select @budgetAmountGroup - @actualAmountGroup as differenceGroup|
|differenceGroup?|
|>>differenceGroup|

!|DatabaseEnvironment|
|commit|
****!
!*****> '''10.1 POST BUDGET'''
!*****> '''10.1.1 CREATE BUDGET (default)'''
|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets/default|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|setBody||
|POST||200|||
|let|$budgetId|js|!-response.jsonbody.Budget.id-!||
|let||js|!-response.jsonbody.Budget.name-!|Default Budget|
|let||js|!-response.jsonbody.Budget.type-!|monthly.by.last.3months.spending|
|let||js|!-response.jsonbody.Budget.createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody.Budget.updatedDate-!|null|
|let|$periodId|js|!-response.jsonbody.Budget.periodId-!||
|let||js|!-response.jsonbody.Budget.periodType-!|budget.period.monthly|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.day-!|1.0|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.day-!|%lastDayOfCurrentMonth%|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.value-!|%budgetIncomeAmount%|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.value-!|%actualIncomeAmount%|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.value-!|%incomeDifference%|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.value-!|%budgetExpenseAmount%|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.value-!|%actualExpenseAmount%|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.value-!|%expenseDifference%|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.value-!|%budgetCashFlow%|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.value-!|%actualCashFlow%|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.value-!|%cashFlowDifference%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.name-!|Business|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.value-!|%actualAmountGroup%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.value-!|%differenceGroup%|
|let|$budgetCategoryId|js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.id-!||
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.name-!|General Business|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.value-!|%budgetAmountCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.value-!|%actualAmountCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.value-!|%differenceCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.categoryId-!|101|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.value-!|%budgetAmountGroup%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.isExpenseCategory-!|true|
****!
!*****> '''10.1.2 CREATE BUDGET (default misstyped)'''
|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets/defautl|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|setBody||
|POST||400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-ErrorCode: 30085 - Invalid Budget Type specified-!|true|
****!
****!
!*****> '''10.2 GET BUDGET '''
!*****> '''10.2.1 GET BUDGET (/budgets/{periodDate})'''
!*****> '''10.2.1.1 GET BUDGET - WITH DATE-RANGE (current date for period)'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/%todayYear%-%todayMonth2%-%todayDay2%|200|||
|let||js|!-response.jsonbody[0].id-!|%budgetId%|
|let||js|!-response.jsonbody[0].name-!|Default Budget|
|let||js|!-response.jsonbody[0].type-!|monthly.by.last.3months.spending|
|let||js|!-response.jsonbody[0].createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody[0].createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody[0].createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody[0].updatedDate-!|null|
|let|$periodId|js|!-response.jsonbody[0].periodId-!|%periodId%|
|let||js|!-response.jsonbody[0].periodType-!|budget.period.monthly|
|let||js|!-response.jsonbody[0].periodStartDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody[0].periodStartDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody[0].periodStartDate.Date.day-!|1.0|
|let||js|!-response.jsonbody[0].periodEndDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody[0].periodEndDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody[0].periodEndDate.Date.day-!|%lastDayOfCurrentMonth%|
|let||js|!-response.jsonbody[0].budgetIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetIncomeAmount.Money.value-!|%budgetIncomeAmount%|
|let||js|!-response.jsonbody[0].actualIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].actualIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].actualIncomeAmount.Money.value-!|%actualIncomeAmount%|
|let||js|!-response.jsonbody[0].incomeDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].incomeDifference.Money.precision-!|2|
|let||js|!-response.jsonbody[0].incomeDifference.Money.value-!|%incomeDifference%|
|let||js|!-response.jsonbody[0].budgetExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetExpenseAmount.Money.value-!|%budgetExpenseAmount%|
|let||js|!-response.jsonbody[0].actualExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].actualExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].actualExpenseAmount.Money.value-!|%actualExpenseAmount%|
|let||js|!-response.jsonbody[0].expenseDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].expenseDifference.Money.precision-!|2|
|let||js|!-response.jsonbody[0].expenseDifference.Money.value-!|%expenseDifference%|
|let||js|!-response.jsonbody[0].budgetCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCashFlow.Money.value-!|%budgetCashFlow%|
|let||js|!-response.jsonbody[0].actualCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].actualCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody[0].actualCashFlow.Money.value-!|%actualCashFlow%|
|let||js|!-response.jsonbody[0].cashFlowDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].cashFlowDifference.Money.precision-!|2|
|let||js|!-response.jsonbody[0].cashFlowDifference.Money.value-!|%cashFlowDifference%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.name-!|Business|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.value-!|%actualAmountGroup%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.difference.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.difference.Money.value-!|%differenceGroup%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.id-!|%budgetCategoryId%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.name-!|General Business|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.value-!|%budgetAmountCategory%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.value-!|%actualAmountCategory%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.value-!|%differenceCategory%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.categoryId-!|101|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.value-!|%budgetAmountGroup%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.isExpenseCategory-!|true|
****!
!*****> '''10.2.1.2 GET BUDGET - WITH DATE-RANGE (past date for period)'''

!*****> Calculation

!|Query|!-select CONVERT(decimal(10,1), case when SUM(t3.amount) > 0 then SUM(t3.amount) else 0 END) as actualIncomeAmount
 from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%income%' and t3.POST_DATE < 2010-11-30-!|
|actualIncomeAmount?|
|>>actualIncomeAmount|
!|Query|!-select CONVERT(decimal(10,1), case when SUM(t3.amount) > 0 then SUM(t3.amount) else 0 END) as actualExpenseAmount
 from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%expense%' and t3.POST_DATE < 2010-11-30-!|
|actualExpenseAmount?|
|>>actualExpenseAmount|
!|Query|!-select CONVERT(decimal(10,1), case when SUM(t3.amount) > 0 then SUM(t3.amount) else 0 END) as actualAmountCategory
 from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.ID='101' and t3.POST_DATE < 2010-11-30-!|
|actualAmountCategory?|
|>>actualAmountCategory|
!|Query|!-select CONVERT(decimal(10,1), case when SUM(t3.amount) > 0 then SUM(t3.amount) else 0 END) as actualAmountGroup
 from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_GROUP='Business' and t3.POST_DATE < 2010-11-30-!|
|actualAmountGroup?|
|>>actualAmountGroup|

!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetExpenseAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%expense%' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetExpenseAmount?|
|>>budgetExpenseAmount|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetIncomeAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%income%' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetIncomeAmount?|
|>>budgetIncomeAmount|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetAmountCategory from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
  t4.ID='101' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetAmountCategory?|
|>>budgetAmountCategory|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetAmountGroup from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
  t4.CATEGORY_GROUP='Business' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetAmountGroup?|
|>>budgetAmountGroup|

!|Query|select @budgetIncomeAmount - CONVERT(decimal(10,2), @actualIncomeAmount) as incomeDifference|
|incomeDifference?|
|>>incomeDifference|
!|Query|select @budgetExpenseAmount - CONVERT(decimal(10,2),@actualExpenseAmount) as expenseDifference|
|expenseDifference?|
|>>expenseDifference|
!|Query|select @actualIncomeAmount- @actualExpenseAmount as actualCashFlow|
|actualCashFlow?|
|>>actualCashFlow|
!|Query|select @budgetIncomeAmount - @budgetExpenseAmount as budgetCashFlow|
|budgetCashFlow?|
|>>budgetCashFlow|
!|Query|select CONVERT(decimal(10,2), @actualCashFlow) - @budgetCashFlow as cashFlowDifference|
|cashFlowDifference?|
|>>cashFlowDifference|
!|Query|select @budgetAmountCategory - CONVERT(decimal(10,2), @actualAmountCategory) as differenceCategory|
|differenceCategory?|
|>>differenceCategory|
!|Query|select @budgetAmountGroup - CONVERT(decimal(10,2), @actualAmountGroup) as differenceGroup|
|differenceGroup?|
|>>differenceGroup|
!|Query|select COUNT(*)+CONVERT(decimal(10,0), @budgetCategoryId) as totalCategory from [BUDGET_CATEGORY]|
|totalCategory?|
|>>newCategoryId|

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|=getPeriodID?|
|periodId|newPeriodId|

****!

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/2010-11-11|200|||
|let||js|!-response.jsonbody[0].id-!|%budgetId%|
|let||js|!-response.jsonbody[0].name-!|Default Budget|
|let||js|!-response.jsonbody[0].type-!|monthly.by.last.3months.spending|
|let||js|!-response.jsonbody[0].createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody[0].createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody[0].createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody[0].updatedDate-!|null|
|let||js|!-response.jsonbody[0].periodId-!||
|let||js|!-response.jsonbody[0].periodType-!|budget.period.monthly|
|let||js|!-response.jsonbody[0].periodStartDate.Date.year-!|2010|
|let||js|!-response.jsonbody[0].periodStartDate.Date.month-!|11|
|let||js|!-response.jsonbody[0].periodStartDate.Date.day-!|1.0|
|let||js|!-response.jsonbody[0].periodEndDate.Date.year-!|2010|
|let||js|!-response.jsonbody[0].periodEndDate.Date.month-!|11|
|let||js|!-response.jsonbody[0].periodEndDate.Date.day-!|30|
|let||js|!-response.jsonbody[0].budgetIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetIncomeAmount.Money.value-!|%budgetIncomeAmount%|
|let||js|!-response.jsonbody[0].actualIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].actualIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].actualIncomeAmount.Money.value-!|%actualIncomeAmount%|
|let||js|!-response.jsonbody[0].incomeDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].incomeDifference.Money.precision-!|2|
|let||js|!-response.jsonbody[0].incomeDifference.Money.value-!|%incomeDifference%|
|let||js|!-response.jsonbody[0].budgetExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetExpenseAmount.Money.value-!|%budgetExpenseAmount%|
|let||js|!-response.jsonbody[0].actualExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].actualExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].actualExpenseAmount.Money.value-!|%actualExpenseAmount%|
|let||js|!-response.jsonbody[0].expenseDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].expenseDifference.Money.precision-!|2|
|let||js|!-response.jsonbody[0].expenseDifference.Money.value-!|%expenseDifference%|
|let||js|!-response.jsonbody[0].budgetCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCashFlow.Money.value-!|%budgetCashFlow%|
|let||js|!-response.jsonbody[0].actualCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].actualCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody[0].actualCashFlow.Money.value-!|%actualCashFlow%|
|let||js|!-response.jsonbody[0].cashFlowDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].cashFlowDifference.Money.precision-!|2|
|let||js|!-response.jsonbody[0].cashFlowDifference.Money.value-!|%cashFlowDifference%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.name-!|Business|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.value-!|%actualAmountGroup%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.difference.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.difference.Money.value-!|%differenceGroup%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.id-!||
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.name-!|General Business|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.value-!|%budgetAmountCategory%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.value-!|%actualAmountCategory%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.value-!|%differenceCategory%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.categoryId-!|101|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.value-!|%budgetAmountGroup%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.isExpenseCategory-!|true|
****!
!*****> '''10.2.1.3 GET BUDGET - WITH DATE-RANGE (future date for period)'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/2020-11-20|200|||
|let||js|response.body|[]|
|comment|OLB745|
****!
!*****> '''10.2.1.4 GET BUDGET - WITH DATE-RANGE (after update transaction amount)'''

!*****> Calculation

#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 555.55 where ID = -! @transactionID1| 
#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 666.66 where ID = -! @transactionID2| 
#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 444.44 where ID = -! @transactionID3| 
#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 333.33 where ID = -! @transactionID4| 
#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 222.22 where ID = -! @transactionID5| 
#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 111.11 where ID = -! @transactionID6| 
#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 777.77 where ID = -! @transactionID7| 
#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 888.88 where ID = -! @transactionID8| 

!|Query|!-select SUM(t3.amount) as actualIncomeAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%income%' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualIncomeAmount?|
|>>actualIncomeAmount|
!|Query|!-select SUM(t3.amount) as actualExpenseAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%expense%' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualExpenseAmount?|
|>>actualExpenseAmount|
!|Query|!-select SUM(t3.amount) as actualAmountCategory from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.ID='101' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualAmountCategory?|
|>>actualAmountCategory|
!|Query|!-select SUM(t3.amount) as actualAmountGroup from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_GROUP='Business' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualAmountGroup?|
|>>actualAmountGroup|

!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetExpenseAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%expense%' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetExpenseAmount?|
|>>budgetExpenseAmount|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetIncomeAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%income%' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetIncomeAmount?|
|>>budgetIncomeAmount|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetAmountCategory from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
  t4.ID='101' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetAmountCategory?|
|>>budgetAmountCategory|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetAmountGroup from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
  t4.CATEGORY_GROUP='Business' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetAmountGroup?|
|>>budgetAmountGroup|

!|Query|select @budgetIncomeAmount - @actualIncomeAmount as incomeDifference|
|incomeDifference?|
|>>incomeDifference|
!|Query|select @budgetExpenseAmount - @actualExpenseAmount as expenseDifference|
|expenseDifference?|
|>>expenseDifference|
!|Query|select @actualIncomeAmount- @actualExpenseAmount as actualCashFlow|
|actualCashFlow?|
|>>actualCashFlow|
!|Query|select @budgetIncomeAmount - @budgetExpenseAmount as budgetCashFlow|
|budgetCashFlow?|
|>>budgetCashFlow|
!|Query|select @actualCashFlow - @budgetCashFlow as cashFlowDifference|
|cashFlowDifference?|
|>>cashFlowDifference|
!|Query|select @budgetAmountCategory - @actualAmountCategory as differenceCategory|
|differenceCategory?|
|>>differenceCategory|
!|Query|select @budgetAmountGroup - @actualAmountGroup as differenceGroup|
|differenceGroup?|
|>>differenceGroup|
!|Query|select COUNT(*)+CONVERT(decimal(10,0), @budgetCategoryId) as totalCategory from [BUDGET_CATEGORY]|
|totalCategory?|
|>>newCategoryId|

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|=getPeriodID?|
|periodId|newPeriodId|

!|DatabaseEnvironment|
|commit|

****!

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/%todayYear%-%todayMonth2%-%todayDay2%|200|||
|let||js|!-response.jsonbody[0].id-!|%budgetId%|
|let||js|!-response.jsonbody[0].name-!|Default Budget|
|let||js|!-response.jsonbody[0].type-!|monthly.by.last.3months.spending|
|let||js|!-response.jsonbody[0].createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody[0].createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody[0].createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody[0].updatedDate-!|null|
|let|$|js|!-response.jsonbody[0].periodId-!|%periodId%|
|let||js|!-response.jsonbody[0].periodType-!|budget.period.monthly|
|let||js|!-response.jsonbody[0].periodStartDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody[0].periodStartDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody[0].periodStartDate.Date.day-!|1.0|
|let||js|!-response.jsonbody[0].periodEndDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody[0].periodEndDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody[0].periodEndDate.Date.day-!|%lastDayOfCurrentMonth%|
|let||js|!-response.jsonbody[0].budgetIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetIncomeAmount.Money.value-!|%budgetIncomeAmount%|
|let||js|!-response.jsonbody[0].actualIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].actualIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].actualIncomeAmount.Money.value-!|%actualIncomeAmount%|
|let||js|!-response.jsonbody[0].incomeDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].incomeDifference.Money.precision-!|2|
|let||js|!-response.jsonbody[0].incomeDifference.Money.value-!|%incomeDifference%|
|let||js|!-response.jsonbody[0].budgetExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetExpenseAmount.Money.value-!|%budgetExpenseAmount%|
|let||js|!-response.jsonbody[0].actualExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].actualExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].actualExpenseAmount.Money.value-!|%actualExpenseAmount%|
|let||js|!-response.jsonbody[0].expenseDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].expenseDifference.Money.precision-!|2|
|let||js|!-response.jsonbody[0].expenseDifference.Money.value-!|%expenseDifference%|
|let||js|!-response.jsonbody[0].budgetCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCashFlow.Money.value-!|%budgetCashFlow%|
|let||js|!-response.jsonbody[0].actualCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].actualCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody[0].actualCashFlow.Money.value-!|%actualCashFlow%|
|let||js|!-response.jsonbody[0].cashFlowDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].cashFlowDifference.Money.precision-!|2|
|let||js|!-response.jsonbody[0].cashFlowDifference.Money.value-!|%cashFlowDifference%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.name-!|Business|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.value-!|%actualAmountGroup%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.difference.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.difference.Money.value-!|%differenceGroup%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.id-!|%budgetCategoryId%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.name-!|General Business|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.value-!|%budgetAmountCategory%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.value-!|%actualAmountCategory%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.value-!|%differenceCategory%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.categoryId-!|101|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.value-!|%budgetAmountGroup%|
|let||js|!-response.jsonbody[0].budgetCategoryGroups[0].BudgetGroup.isExpenseCategory-!|true|
****!
!*****> '''10.2.1.5 GET BUDGET - WITH DATE-RANGE (incorrect date)'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/2010-13-20|400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-Argument periodDate (Date/Time/Timestamp) is invalid. Format=yyyy-MM-dd-!|true|
****!
!*****> '''10.2.1.6 GET BUDGET - WITH DATE-RANGE (incorrect formatted date)'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/2010/13/20|404|||
|let||js|!-response.jsonbody-!|null|
****!
****!
!*****> '''10.2.2 GET BUDGET (/budgets//{budgetId}/{periodDate})'''
!*****> '''10.2.2.1 GET BUDGET - WITH BUDGETID/DATE-RANGE (current date)'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/%budgetId%/%todayYear%-%todayMonth2%-%todayDay2%|200|||
|let||js|!-response.jsonbody.Budget.id-!|%budgetId%|
|let||js|!-response.jsonbody.Budget.name-!|Default Budget|
|let||js|!-response.jsonbody.Budget.type-!|monthly.by.last.3months.spending|
|let||js|!-response.jsonbody.Budget.createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody.Budget.updatedDate-!|null|
|let||js|!-response.jsonbody.Budget.periodId-!|%periodId%|
|let||js|!-response.jsonbody.Budget.periodType-!|budget.period.monthly|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.day-!|1.0|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.day-!|%lastDayOfCurrentMonth%|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.value-!|%budgetIncomeAmount%|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.value-!|%actualIncomeAmount%|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.value-!|%incomeDifference%|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.value-!|%budgetExpenseAmount%|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.value-!|%actualExpenseAmount%|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.value-!|%expenseDifference%|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.value-!|%budgetCashFlow%|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.value-!|%actualCashFlow%|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.value-!|%cashFlowDifference%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.name-!|Business|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.value-!|%actualAmountGroup%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.value-!|%differenceGroup%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.id-!|%budgetCategoryId%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.name-!|General Business|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.value-!|%budgetAmountCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.value-!|%actualAmountCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.value-!|%differenceCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.categoryId-!|101|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.value-!|%budgetAmountGroup%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.isExpenseCategory-!|true|
****!
!*****> '''10.2.2.1 GET BUDGET - WITH BUDGETID/DATE-RANGE (past date)'''

!*****> Calculation

!|Query|!-select CONVERT(decimal(10,1), case when SUM(t3.amount) > 0 then SUM(t3.amount) else 0 END) as actualIncomeAmount
 from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%income%' and t3.POST_DATE < 2010-11-30-!|
|actualIncomeAmount?|
|>>actualIncomeAmount|
!|Query|!-select CONVERT(decimal(10,1), case when SUM(t3.amount) > 0 then SUM(t3.amount) else 0 END) as actualExpenseAmount
 from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%expense%' and t3.POST_DATE < 2010-11-30-!|
|actualExpenseAmount?|
|>>actualExpenseAmount|
!|Query|!-select CONVERT(decimal(10,1), case when SUM(t3.amount) > 0 then SUM(t3.amount) else 0 END) as actualAmountCategory
 from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.ID='101' and t3.POST_DATE < 2010-11-30-!|
|actualAmountCategory?|
|>>actualAmountCategory|
!|Query|!-select CONVERT(decimal(10,1), case when SUM(t3.amount) > 0 then SUM(t3.amount) else 0 END) as actualAmountGroup
 from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_GROUP='Business' and t3.POST_DATE < 2010-11-30-!|
|actualAmountGroup?|
|>>actualAmountGroup|

!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetExpenseAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%expense%' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetExpenseAmount?|
|>>budgetExpenseAmount|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetIncomeAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%income%' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetIncomeAmount?|
|>>budgetIncomeAmount|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetAmountCategory from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
  t4.ID='101' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetAmountCategory?|
|>>budgetAmountCategory|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetAmountGroup from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
  t4.CATEGORY_GROUP='Business' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetAmountGroup?|
|>>budgetAmountGroup|

!|Query|select @budgetIncomeAmount - CONVERT(decimal(10,2), @actualIncomeAmount) as incomeDifference|
|incomeDifference?|
|>>incomeDifference|
!|Query|select @budgetExpenseAmount - CONVERT(decimal(10,2),@actualExpenseAmount) as expenseDifference|
|expenseDifference?|
|>>expenseDifference|
!|Query|select @actualIncomeAmount- @actualExpenseAmount as actualCashFlow|
|actualCashFlow?|
|>>actualCashFlow|
!|Query|select @budgetIncomeAmount - @budgetExpenseAmount as budgetCashFlow|
|budgetCashFlow?|
|>>budgetCashFlow|
!|Query|select CONVERT(decimal(10,2), @actualCashFlow) - @budgetCashFlow as cashFlowDifference|
|cashFlowDifference?|
|>>cashFlowDifference|
!|Query|select @budgetAmountCategory - CONVERT(decimal(10,2), @actualAmountCategory) as differenceCategory|
|differenceCategory?|
|>>differenceCategory|
!|Query|select @budgetAmountGroup - CONVERT(decimal(10,2), @actualAmountGroup) as differenceGroup|
|differenceGroup?|
|>>differenceGroup|
!|Query|select COUNT(*)+CONVERT(decimal(10,0), @budgetCategoryId) as totalCategory from [BUDGET_CATEGORY]|
|totalCategory?|
|>>newCategoryId|

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|=getPeriodID?|
|periodId|newPeriodId|

****!

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/%budgetId%/2010-10-11|200|||
|let||js|!-response.jsonbody.Budget.id-!|%budgetId%|
|let||js|!-response.jsonbody.Budget.name-!|Default Budget|
|let||js|!-response.jsonbody.Budget.type-!|monthly.by.last.3months.spending|
|let||js|!-response.jsonbody.Budget.createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody.Budget.updatedDate-!|null|
|let||js|!-response.jsonbody.Budget.periodId-!||
|let||js|!-response.jsonbody.Budget.periodType-!|budget.period.monthly|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.year-!|2010|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.month-!|10|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.day-!|1.0|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.year-!|2010|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.month-!|10|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.day-!|31|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.value-!|%budgetIncomeAmount%|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.value-!|%actualIncomeAmount%|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.value-!|%incomeDifference%|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.value-!|%budgetExpenseAmount%|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.value-!|%actualExpenseAmount%|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.value-!|%expenseDifference%|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.value-!|%budgetCashFlow%|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.value-!|%actualCashFlow%|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.value-!|%cashFlowDifference%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.name-!|Business|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.value-!|%actualAmountGroup%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.value-!|%differenceGroup%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.id-!||
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.name-!|General Business|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.value-!|%budgetAmountCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.value-!|%actualAmountCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.value-!|%differenceCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.categoryId-!|101|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.value-!|%budgetAmountGroup%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.isExpenseCategory-!|true|
****!
!*****> '''10.2.2.3 GET BUDGET - WITH BUDGETID/DATE-RANGE (future date)'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/%budgetId%/2021-11-10|200||no-body|
****!
!*****> '''10.2.2.4 GET BUDGET - WITH DATE-RANGE (after update transaction amount)'''

!*****> Calculation

#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 55.55 where ID = -! @transactionID1| 
#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 66.66 where ID = -! @transactionID2| 
#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 44.44 where ID = -! @transactionID3| 
#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 33.33 where ID = -! @transactionID4| 
#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 22.22 where ID = -! @transactionID5| 
#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 11.11 where ID = -! @transactionID6| 
#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 77.77 where ID = -! @transactionID7| 
#!|Execute|!-update [OLB_TRANSACTION] set AMOUNT = 88.88 where ID = -! @transactionID8| 

!|Query|!-select SUM(t3.amount) as actualIncomeAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%income%' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualIncomeAmount?|
|>>actualIncomeAmount|
!|Query|!-select SUM(t3.amount) as actualExpenseAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%expense%' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualExpenseAmount?|
|>>actualExpenseAmount|
!|Query|!-select SUM(t3.amount) as actualAmountCategory from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.ID='101' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualAmountCategory?|
|>>actualAmountCategory|
!|Query|!-select SUM(t3.amount) as actualAmountGroup from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_GROUP='Business' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualAmountGroup?|
|>>actualAmountGroup|

!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetExpenseAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%expense%' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetExpenseAmount?|
|>>budgetExpenseAmount|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetIncomeAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%income%' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetIncomeAmount?|
|>>budgetIncomeAmount|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetAmountCategory from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
  t4.ID='101' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetAmountCategory?|
|>>budgetAmountCategory|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetAmountGroup from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
  t4.CATEGORY_GROUP='Business' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetAmountGroup?|
|>>budgetAmountGroup|

!|Query|select @budgetIncomeAmount - @actualIncomeAmount as incomeDifference|
|incomeDifference?|
|>>incomeDifference|
!|Query|select @budgetExpenseAmount - @actualExpenseAmount as expenseDifference|
|expenseDifference?|
|>>expenseDifference|
!|Query|select @actualIncomeAmount- @actualExpenseAmount as actualCashFlow|
|actualCashFlow?|
|>>actualCashFlow|
!|Query|select @budgetIncomeAmount - @budgetExpenseAmount as budgetCashFlow|
|budgetCashFlow?|
|>>budgetCashFlow|
!|Query|select @actualCashFlow - @budgetCashFlow as cashFlowDifference|
|cashFlowDifference?|
|>>cashFlowDifference|
!|Query|select @budgetAmountCategory - @actualAmountCategory as differenceCategory|
|differenceCategory?|
|>>differenceCategory|
!|Query|select @budgetAmountGroup - @actualAmountGroup as differenceGroup|
|differenceGroup?|
|>>differenceGroup|
!|Query|select COUNT(*)+CONVERT(decimal(10,0), @budgetCategoryId) as totalCategory from [BUDGET_CATEGORY]|
|totalCategory?|
|>>newCategoryId|

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|=getPeriodID?|
|periodId|newPeriodId|

!|DatabaseEnvironment|
|commit|

****!

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/%budgetId%/%todayYear%-%todayMonth2%-%todayDay2%|200|||
|let|$budgetID2|js|!-response.jsonbody.Budget.id-!|%budgetId%|
|let||js|!-response.jsonbody.Budget.name-!|Default Budget|
|let||js|!-response.jsonbody.Budget.type-!|monthly.by.last.3months.spending|
|let||js|!-response.jsonbody.Budget.createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody.Budget.updatedDate-!|null|
|let||js|!-response.jsonbody.Budget.periodId-!||
|let||js|!-response.jsonbody.Budget.periodType-!|budget.period.monthly|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.day-!|1.0|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.day-!|%lastDayOfCurrentMonth%|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.value-!|%budgetIncomeAmount%|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.value-!|%actualIncomeAmount%|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.value-!|%incomeDifference%|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.value-!|%budgetExpenseAmount%|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.value-!|%actualExpenseAmount%|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.value-!|%expenseDifference%|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.value-!|%budgetCashFlow%|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.value-!|%actualCashFlow%|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.value-!|%cashFlowDifference%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.name-!|Business|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.value-!|%actualAmountGroup%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.value-!|%differenceGroup%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.id-!|%budgetCategoryId%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.name-!|General Business|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.value-!|%budgetAmountCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.value-!|%actualAmountCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.value-!|%differenceCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.categoryId-!|101|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.value-!|%budgetAmountGroup%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.isExpenseCategory-!|true|
|comment||
****!
!*****> '''10.2.2.5 GET BUDGET - WITH BUDGETID/DATE-RANGE (incorrect date)'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/%budgetId%/2012-11-40|400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!- Argument periodDate (Date/Time/Timestamp) is invalid. Format=yyyy-MM-dd-!|true|
****!
!*****> '''10.2.2.6 GET BUDGET - WITH BUDGETID/DATE-RANGE (incorrect formatted date)'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/%budgetId%/2021/11/10|404|||
****!
!*****> '''10.2.2.7 GET BUDGET - WITH BUDGETID/DATE-RANGE (invalid budgetId)'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/%budgetId%23/%todayYear%-%todayMonth2%-%todayDay2%|400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-ErrorCode: 200001 - Argument budgetId is invalid.-!|true|
****!
****!
!*****> '''10.2.3 GET BUDGET (/forecast)'''
!*****> '''10.2.3.1 GET BUDGET - FORECAST'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets/forecast|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET||200|||
|let||js|!-response.jsonbody.BudgetForecast.budgetExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.BudgetForecast.budgetExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.BudgetForecast.budgetExpenseAmount.Money.value-!|%budgetExpenseAmount%|
|let||js|!-response.jsonbody.BudgetForecast.actualExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.BudgetForecast.actualExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.BudgetForecast.actualExpenseAmount.Money.value-!|%actualExpenseAmount%|
|let||js|!-response.jsonbody.BudgetForecast.expenseDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.BudgetForecast.expenseDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.BudgetForecast.expenseDifference.Money.value-!|%expenseDifference%|
****!
****!
!*****> '''10.2.4 GET BUDGET (/budgets/by-month/{budgetId}/{periodStartDate}/{periodEndDate})'''

'''10.2.4.1 periodEndDate is higher than periodStartDate'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets/by-month|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|comment|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/%budgetId%/2012-12-22/2011-12-22|400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-ErrorCode: 30067 - Invalid Argument - endDate must be greater than startDate-!|true|

'''10.2.4.2 non-existing budgetId'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets/by-month|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/123456/2011-12-22/2013-12-22|400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-ErrorCode: 200001 - Argument budgetId is invalid.-!|true|

'''10.2.4.4 future periodStartDate'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets/by-month|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/%budgetId%/2022-12-22/2030-12-22|500|||
|GET|/%budgetId%/2008-12-22/2020-12-22|500|||
|comment|APDB-593|

'''10.2.4.5 current dates'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets/by-month|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/%budgetId%/2011-12-22/2030-12-22|200|||
|let||js|!-response.jsonbody.Budget.id-!|%budgetId%|
|let||js|!-response.jsonbody.Budget.name-!|Default Budget|
|let||js|!-response.jsonbody.Budget.type-!|monthly.by.last.3months.spending|
|let||js|!-response.jsonbody.Budget.createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody.Budget.updatedDate-!|null|
|let||js|!-response.jsonbody.Budget.periodId-!||
|let||js|!-response.jsonbody.Budget.periodType-!|budget.period.monthly|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.year-!|2011|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.month-!|12|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.day-!|1.0|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.year-!|2030|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.month-!|12|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.day-!|31|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.value-!||
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.value-!||
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.value-!||
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.value-!||
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.value-!||
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.value-!||
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.value-!||
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.value-!||
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.value-!||
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.name-!|Business|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.value-!||
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.value-!||
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.id-!||
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.name-!|General Business|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.value-!||
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.value-!||
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.value-!||
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.categoryId-!|101|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.value-!||
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.isExpenseCategory-!|true|

'''10.2.4.5 today dates'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets/by-month|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|GET|/%budgetId%/%todayYear%-%todayMonth2%-%todayDay2%/%todayYear%-%todayMonth2%-%todayDay2%|200|||
|let||js|!-response.jsonbody.Budget.id-!|%budgetId%|
****!
****!
!*****> '''10.3 PUT BUDGET '''
!*****> '''10.3.1 Update Budget Category Amount '''
!*****> '''10.3.1.1 Update Budget Category Amount '''

!define budgetAmount {7.77}
!define testCategoryID {101}

!*****> Calculation

!|Query|!-select SUM(t3.amount) as actualIncomeAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%income%' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualIncomeAmount?|
|>>actualIncomeAmount|
!|Query|!-select SUM(t3.amount) as actualExpenseAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%expense%' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualExpenseAmount?|
|>>actualExpenseAmount|
!|Query|!-select SUM(t3.amount) as actualAmountCategory from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.ID='101' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualAmountCategory?|
|>>actualAmountCategory|
!|Query|!-select SUM(t3.amount) as actualAmountGroup from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_GROUP='Business' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualAmountGroup?|
|>>actualAmountGroup|

!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3+-!${budgetAmount}!-)) as budgetExpenseAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%expense%' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0) and NOT t4.ID = -!${testCategoryID}|
|budgetExpenseAmount?|
|>>budgetExpenseAmount|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetIncomeAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%income%' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetIncomeAmount?|
|>>budgetIncomeAmount|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetAmountCategory from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
  t4.ID='101' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetAmountCategory?|
|>>budgetAmountCategory|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetAmountGroup from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
  t4.CATEGORY_GROUP='Business' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetAmountGroup?|
|>>budgetAmountGroup|

!|Query|select @budgetIncomeAmount - @actualIncomeAmount as incomeDifference|
|incomeDifference?|
|>>incomeDifference|
!|Query|select @budgetExpenseAmount - @actualExpenseAmount as expenseDifference|
|expenseDifference?|
|>>expenseDifference|
!|Query|select @actualIncomeAmount- @actualExpenseAmount as actualCashFlow|
|actualCashFlow?|
|>>actualCashFlow|
!|Query|select @budgetIncomeAmount - @budgetExpenseAmount as budgetCashFlow|
|budgetCashFlow?|
|>>budgetCashFlow|
!|Query|select @actualCashFlow - @budgetCashFlow as cashFlowDifference|
|cashFlowDifference?|
|>>cashFlowDifference|
!|Query|select ${budgetAmount} - @actualAmountCategory as differenceCategory|
|differenceCategory?|
|>>differenceCategory|
!|Query|select ${budgetAmount} - @actualAmountGroup as differenceGroup|
|differenceGroup?|
|>>differenceGroup|
!|Query|select COUNT(*)+CONVERT(decimal(10,0), @budgetCategoryId) as totalCategory from [BUDGET_CATEGORY]|
|totalCategory?|
|>>newCategoryId|
!|Query|select Top 1 ID + 1 as lastPeriodId from [BUDGET_PERIOD] order by ID DESC|
|lastPeriodId?|
|>>newPeriodId|

!|DatabaseEnvironment|
|commit|

****!

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|setBody|!-{
    "Money":
    {
        "currencyCode": "USD",
        "precision": 2,
        "value": "-!${budgetAmount}!-"
    }}-!|
|PUT|/%budgetCategoryId%|200|||
|let||js|!-response.jsonbody.Budget.id-!|%budgetId%|
|let||js|!-response.jsonbody.Budget.name-!|Default Budget|
|let||js|!-response.jsonbody.Budget.type-!|monthly.by.last.3months.spending|
|let||js|!-response.jsonbody.Budget.createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody.Budget.updatedDate-!|null|
|let||js|!-response.jsonbody.Budget.periodId-!|%periodId%|
|let||js|!-response.jsonbody.Budget.periodType-!|budget.period.monthly|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.day-!|1.0|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.day-!|%lastDayOfCurrentMonth%|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.value-!|%budgetIncomeAmount%|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.value-!|%actualIncomeAmount%|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.value-!|%incomeDifference%|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.value-!|%budgetExpenseAmount%|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.value-!|%actualExpenseAmount%|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.value-!|%expenseDifference%|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.value-!|%budgetCashFlow%|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.value-!|%actualCashFlow%|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.value-!|%cashFlowDifference%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.name-!|Business|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.value-!|%actualAmountGroup%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.precision-!||
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.value-!|%differenceGroup%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.id-!|%budgetCategoryId%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.name-!|General Business|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.value-!|${budgetAmount}|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.value-!|%actualAmountCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.value-!|%differenceCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.categoryId-!|${testCategoryID}|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.value-!|${budgetAmount}|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.isExpenseCategory-!|true|
|comment|precision = 48|
****!
!*****> '''10.3.1.2 Update Budget Category Amount (non-existing categoryID) '''
|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|setBody|!-{
    "Money":
    {
        "currencyCode": "USD",
        "precision": 2,
        "value": "-!${budgetAmount}!-"
    }}-!|
|PUT|/465465|400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg||true|

****!
!*****> '''10.3.1.3 Update Budget Category Amount (value is empty) '''
|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|setBody|!-{
    "Money":
    {
        "currencyCode": "USD",
        "precision": 2,
        "value": ""
    }}-!|
|PUT|/465465|400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-Argument money-value is undefined.-!|true|
****!
****!
!*****> '''10.3.2 Reset Budget (last 3 months) '''
!*****> '''10.3.2.1 Reset Budget (last 3 months) '''
!*****> Calculation

!|Query|!-select SUM(t3.amount) as actualIncomeAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%income%' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualIncomeAmount?|
|>>actualIncomeAmount|
!|Query|!-select SUM(t3.amount) as actualExpenseAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%expense%' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualExpenseAmount?|
|>>actualExpenseAmount|
!|Query|!-select SUM(t3.amount) as actualAmountCategory from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.ID='101' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualAmountCategory?|
|>>actualAmountCategory|
!|Query|!-select SUM(t3.amount) as actualAmountGroup from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_GROUP='Business' and t3.POST_DATE >= DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|actualAmountGroup?|
|>>actualAmountGroup|

!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetExpenseAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%expense%' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetExpenseAmount?|
|>>budgetExpenseAmount|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetIncomeAmount from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
 t4.CATEGORY_TYPE like '%income%' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetIncomeAmount?|
|>>budgetIncomeAmount|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetAmountCategory from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
  t4.ID='101' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetAmountCategory?|
|>>budgetAmountCategory|
!|Query|!-select CONVERT(decimal(10,2), CONVERT(varbinary(20), SUM(t3.amount)/3)) as budgetAmountGroup from [USER_TRANSACTION_JOIN] as t1, [SPLIT_CATEGORIZATION] as t2, [OLB_TRANSACTION] as t3, [CATEGORY] as t4
 where t3.ID=t1.TRANSACTION_ID and t1.ID=t2.USER_TRANSACTION_JOIN_ID and t2.CATEGORY_ID=t4.ID and
  t4.CATEGORY_GROUP='Business' and t3.POST_DATE < DATEADD(month, DATEDIFF(month, 0, GETDATE()), 0)-!|
|budgetAmountGroup?|
|>>budgetAmountGroup|

!|Query|select @budgetIncomeAmount - @actualIncomeAmount as incomeDifference|
|incomeDifference?|
|>>incomeDifference|
!|Query|select @budgetExpenseAmount - @actualExpenseAmount as expenseDifference|
|expenseDifference?|
|>>expenseDifference|
!|Query|select @actualIncomeAmount- @actualExpenseAmount as actualCashFlow|
|actualCashFlow?|
|>>actualCashFlow|
!|Query|select @budgetIncomeAmount - @budgetExpenseAmount as budgetCashFlow|
|budgetCashFlow?|
|>>budgetCashFlow|
!|Query|select @actualCashFlow - @budgetCashFlow as cashFlowDifference|
|cashFlowDifference?|
|>>cashFlowDifference|
!|Query|select @budgetAmountCategory - @actualAmountCategory as differenceCategory|
|differenceCategory?|
|>>differenceCategory|
!|Query|select @budgetAmountGroup - @actualAmountGroup as differenceGroup|
|differenceGroup?|
|>>differenceGroup|

!|DatabaseEnvironment|
|commit|
****!

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets/reset|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|setBody|!--!|
|PUT|/%budgetID2%|200|||
|let|$budgetId|js|!-response.jsonbody.Budget.id-!||
|let||js|!-response.jsonbody.Budget.name-!|Default Budget|
|let||js|!-response.jsonbody.Budget.type-!|monthly.by.last.3months.spending|
|let||js|!-response.jsonbody.Budget.createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody.Budget.updatedDate-!|null|
|let|$periodId|js|!-response.jsonbody.Budget.periodId-!||
|let||js|!-response.jsonbody.Budget.periodType-!|budget.period.monthly|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.periodStartDate.Date.day-!|1.0|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.Budget.periodEndDate.Date.day-!|%lastDayOfCurrentMonth%|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetIncomeAmount.Money.value-!|%budgetIncomeAmount%|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualIncomeAmount.Money.value-!|%actualIncomeAmount%|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.incomeDifference.Money.value-!|%incomeDifference%|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetExpenseAmount.Money.value-!|%budgetExpenseAmount%|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualExpenseAmount.Money.value-!|%actualExpenseAmount%|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.expenseDifference.Money.value-!|%expenseDifference%|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCashFlow.Money.value-!|%budgetCashFlow%|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.actualCashFlow.Money.value-!|%actualCashFlow%|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.cashFlowDifference.Money.value-!|%cashFlowDifference%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.name-!|Business|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.actualAmount.Money.value-!|%actualAmountGroup%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.difference.Money.value-!|%differenceGroup%|
|let|$budgetCategoryId|js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.id-!||
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.name-!|General Business|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.budgetAmount.Money.value-!|%budgetAmountCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.actualAmount.Money.value-!|%actualAmountCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.difference.Money.value-!|%differenceCategory%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetCategories[0].BudgetCategory.categoryId-!|101|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.budgetAmount.Money.value-!|%budgetAmountGroup%|
|let||js|!-response.jsonbody.Budget.budgetCategoryGroups[0].BudgetGroup.isExpenseCategory-!|true|
****!
!*****> '''10.3.2.2 Reset Budget (budgetID does not exist) '''
|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets/reset|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|setBody|!--!|
|PUT|/12345|400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-ErrorCode: 200001 - Argument budgetId is invalid.-!|true|
****!
****!
****!
!*****> '''10.4 DELETE BUDGET'''
!*****> '''10.4.1 Delete Budget '''
|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|setBody|!--!|
|DELETE|/%budgetID2%|204|||
****!
!*****> '''10.4.2 Delete Budget (budgetID does not exist) '''
|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/budgets|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|setBody|!--!|
|DELETE|/%budgetID2%|400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-ErrorCode: 200001 - Argument budgetId is invalid. -!|true|
****!
****!
!*****> Clean-up Test Data

!|Query|!-select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-1'-!|
|ID?|
|>>trID1|
!|Query|!-select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-2'-!|
|ID?|
|>>trID2|
!|Query|!-select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-3'-!|
|ID?|
|>>trID3|
!|Query|!-select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-4'-!|
|ID?|
|>>trID4|
!|Query|!-select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-5'-!|
|ID?|
|>>trID5|
!|Query|!-select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-6'-!|
|ID?|
|>>trID6|
!|Query|!-select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-7'-!|
|ID?|
|>>trID7|
!|Query|!-select ID from [OLB_TRANSACTION] where NAME = 'BudgetTestTransaction-8'-!|
|ID?|
|>>trID8|
!|Query|!-select ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@trID1|
|ID?|
|>>userTrJoin1|
!|Query|!-select ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@trID2|
|ID?|
|>>userTrJoin2|
!|Query|!-select ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@trID3|
|ID?|
|>>userTrJoin3|
!|Query|!-select ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@trID4|
|ID?|
|>>userTrJoin4|
!|Query|!-select ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@trID5|
|ID?|
|>>userTrJoin5|
!|Query|!-select ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@trID6|
|ID?|
|>>userTrJoin6|
!|Query|!-select ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@trID7|
|ID?|
|>>userTrJoin7|
!|Query|!-select ID from [USER_TRANSACTION_JOIN] where TRANSACTION_ID = -!@trID8|
|ID?|
|>>userTrJoin8|


!|Execute|!-delete [SPLIT_CATEGORIZATION] where USER_TRANSACTION_JOIN_ID =-! @userTrJoin1 !-
            delete [SPLIT_CATEGORIZATION] where USER_TRANSACTION_JOIN_ID =-! @userTrJoin2 !-
            delete [SPLIT_CATEGORIZATION] where USER_TRANSACTION_JOIN_ID =-! @userTrJoin3 !-
            delete [SPLIT_CATEGORIZATION] where USER_TRANSACTION_JOIN_ID =-! @userTrJoin4 !-
            delete [SPLIT_CATEGORIZATION] where USER_TRANSACTION_JOIN_ID =-! @userTrJoin5 !-
            delete [SPLIT_CATEGORIZATION] where USER_TRANSACTION_JOIN_ID =-! @userTrJoin6 !-
            delete [SPLIT_CATEGORIZATION] where USER_TRANSACTION_JOIN_ID =-! @userTrJoin7 !-
            delete [SPLIT_CATEGORIZATION] where USER_TRANSACTION_JOIN_ID =-! @userTrJoin8 !- 
            delete from [USER_TRANSACTION_JOIN] where TRANSACTION_ID =-! @trID1!- 
            delete from [USER_TRANSACTION_JOIN] where TRANSACTION_ID =-! @trID2!- 
            delete from [USER_TRANSACTION_JOIN] where TRANSACTION_ID =-! @trID3!- 
            delete from [USER_TRANSACTION_JOIN] where TRANSACTION_ID =-! @trID4!- 
            delete from [USER_TRANSACTION_JOIN] where TRANSACTION_ID =-! @trID5!- 
            delete from [USER_TRANSACTION_JOIN] where TRANSACTION_ID =-! @trID6!- 
            delete from [USER_TRANSACTION_JOIN] where TRANSACTION_ID =-! @trID7!- 
            delete from [USER_TRANSACTION_JOIN] where TRANSACTION_ID =-! @trID8!- 
            delete from [OLB_TRANSACTION] where ID =-! @trID1!- 
            delete from [OLB_TRANSACTION] where ID =-! @trID2!- 
            delete from [OLB_TRANSACTION] where ID =-! @trID3!- 
            delete from [OLB_TRANSACTION] where ID =-! @trID4!- 
            delete from [OLB_TRANSACTION] where ID =-! @trID5!- 
            delete from [OLB_TRANSACTION] where ID =-! @trID6!- 
            delete from [OLB_TRANSACTION] where ID =-! @trID7!- 
            delete from [OLB_TRANSACTION] where ID =-! @trID8|

!|DatabaseEnvironment|
|commit|
****!
****!