!*****> !style_green[1. FINANCIAL GOAL]
!*****>  Create Test Data

''Create Accounts''

!|Execute|!-insert into [OLB_ACCOUNT]([BRANCH_ID],[STATUS],[INTERFACE_ID],[ACCOUNT_NAME],[ACCOUNT_NUMBER],[ACCOUNT_TYPE],[ACCOUNT_CLASS]
      ,[BALANCE],[SYNC_DATE],[CREATED_DATE],[ACCOUNT_STATUS],[AVAILABLE_BALANCE],[DIRECT_CONNECT],[DIRECT_ID]
      ,[OUTSTANDING_BALANCE],[INTEREST_RATE],[LOAN_AMOUNT],[ACCOUNT_OPEN_DATE]
      ,[APR]) values (1, 'accountstatus.open', null,'TransactionSearchTest1', null, 'accounttype.annuity', 
      'accountclass.otherasset', 2000, SYSDATETIME(), SYSDATETIME(), null, 2500, 0, 'TestDirectID1', 10.00, 12.11, 12000.00, SYSDATETIME(), 15)-!|

!|Query|!-select [ACCOUNT_ID] from [OLB_ACCOUNT] where ACCOUNT_NAME = 'TransactionSearchTest1'-!|
|[ACCOUNT_ID]?|
|>>account1|

!|Execute|!-insert into [USER_ACCOUNT_JOIN]([USER_ID],[ACCOUNT_ID],[NICKNAME],[EXCLUDED],[HIDDEN],[HIDE_BY_ADMIN]) 
		  values (-!@userID2!-, -!@account1!-, SYSDATETIME(), 0,0,0)-!|

!|Query|!-select ID from [USER_ACCOUNT_JOIN] where ACCOUNT_ID =-!@account1|
|[ID]?|
|>>userAccJoinID1|


!|Execute|!-insert into [OLB_ACCOUNT]([BRANCH_ID],[STATUS],[INTERFACE_ID],[ACCOUNT_NAME],[ACCOUNT_NUMBER],[ACCOUNT_TYPE],[ACCOUNT_CLASS]
      ,[BALANCE],[SYNC_DATE],[CREATED_DATE],[ACCOUNT_STATUS],[AVAILABLE_BALANCE],[DIRECT_CONNECT],[DIRECT_ID]
      ,[OUTSTANDING_BALANCE],[INTEREST_RATE],[LOAN_AMOUNT],[ACCOUNT_OPEN_DATE]
      ,[APR]) values (1, 'accountstatus.open', null,'TransactionSearchTest2', null, 'accounttype.annuity', 
      'accountclass.otherasset', 12000.25, SYSDATETIME(), SYSDATETIME(), null, 12500.25, 0, null, 10.00, 12.11, 12000.00, SYSDATETIME(), 15)-!|

!|Query|!-select [ACCOUNT_ID] from [OLB_ACCOUNT] where ACCOUNT_NAME = 'TransactionSearchTest2'-!|
|[ACCOUNT_ID]?|
|>>account2|

!|Execute|!-insert into [USER_ACCOUNT_JOIN]([USER_ID],[ACCOUNT_ID],[NICKNAME],[EXCLUDED],[HIDDEN],[HIDE_BY_ADMIN]) 
		  values (-!@userID2!-, -!@account2!-, SYSDATETIME(), 0,0,0)-!|

!|Query|!-select ID from [USER_ACCOUNT_JOIN] where ACCOUNT_ID =-!@account2|
|[ID]?|
|>>userAccJoinID2|

!|DatabaseEnvironment|
|commit|

****!
!*****> '''1.1 POST FINANCIAL GOAL'''
!*****> '''1.1.1 POST FINANCIAL GOAL (/financialgoals)'''

'''1.1.1.1 Fields set to null'''

!|Query|!- select count(*)+2 as t from [FINANCIAL_GOAL]-!|
|t?|
|>>totalFinancialGoal|

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|comment|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": null,
        "financialGoalType": null,
        "dateNeeded": null,
        "createdDate": null,
        "financialGoalAmount": null,
        "monthlyAmount": null,
        "startAmount": null,
        "rateOfReturn": null,
        "retirementAge": null,
        "monthlyRetirementAmount": null,
        "inBudget": null,
        "startDate": null,
        "dateOfBirth": null,
        "currentAmount": null,
        "percentComplete": null,
        "saveNewGoal": null,
        "financialGoalAccounts": null
    }
}-!|
|POST||400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-ErrorCode: 200002 - Argument goalDetailDTOToSave-financialGoalName is undefined but is required.-!|true|

'''1.1.1.2 financialGoalName set to not null'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": "Test financialGoalName",
        "financialGoalType": null,
        "dateNeeded": null,
        "createdDate": null,
        "financialGoalAmount": null,
        "monthlyAmount": null,
        "startAmount": null,
        "rateOfReturn": null,
        "retirementAge": null,
        "monthlyRetirementAmount": null,
        "inBudget": null,
        "startDate": null,
        "dateOfBirth": null,
        "currentAmount": null,
        "percentComplete": null,
        "saveNewGoal": null,
        "financialGoalAccounts": null
    }
}-!|
|POST||400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-ErrorCode: 200002 - Argument goalDetailDTOToSave-financialGoalType is undefined but is required.-!|true|

'''1.1.1.3 financialGoalName, financialGoalType set to not null'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": "Test financialGoalName",
        "financialGoalType": "financial.goal.retirement",
        "dateNeeded": null,
        "createdDate": null,
        "financialGoalAmount": null,
        "monthlyAmount": null,
        "startAmount": null,
        "rateOfReturn": null,
        "retirementAge": null,
        "monthlyRetirementAmount": null,
        "inBudget": null,
        "startDate": null,
        "dateOfBirth": null,
        "currentAmount": null,
        "percentComplete": null,
        "saveNewGoal": null,
        "financialGoalAccounts": null
    }
}-!|
|POST||400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-ErrorCode: 200002 - Argument goalDetailDTOToSave-retirementAge is undefined but is required.-!|true|

'''1.1.1.4 financialGoalName, financialGoalType, retirementAge set to not null'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": "Test financialGoalName",
        "financialGoalType": "financial.goal.retirement",
        "dateNeeded": null,
        "createdDate": null,
        "financialGoalAmount": null,
        "monthlyAmount": null,
        "startAmount": null,
        "rateOfReturn": null,
        "retirementAge": 70,
        "monthlyRetirementAmount": null,
        "inBudget": null,
        "startDate": null,
        "dateOfBirth": null,
        "currentAmount": null,
        "percentComplete": null,
        "saveNewGoal": null,
        "financialGoalAccounts": null
    }
}-!|
|POST||400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-ErrorCode: 200001 - Argument goalDetailDTOToSave-financialGoalAmount is invalid.-!|true|

'''1.1.1.5 financialGoalName, financialGoalType, retirementAge, financialGoalAmount set to not null'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": "Test financialGoalName",
        "financialGoalType": "financial.goal.retirement",
        "dateNeeded": null,
        "createdDate": null,
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 5000
            }
        }, 
        "monthlyAmount": null,
        "startAmount": null,
        "rateOfReturn": null,
        "retirementAge": 70,
        "monthlyRetirementAmount": null,
        "inBudget": null,
        "startDate": null,
        "dateOfBirth": null,
        "currentAmount": null,
        "percentComplete": null,
        "saveNewGoal": null,
        "financialGoalAccounts": null
    }
}-!|
|POST||200|||

'''1.1.1.5 financialGoalName, financialGoalType, retirementAge, financialGoalAmount set to not null'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": "Test financialGoalName-1",
        "financialGoalType": "financial.goal.retirement",
        "dateNeeded": null,
        "createdDate": null,
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 5000
            }
        }, 
        "monthlyAmount": null,
        "startAmount": null,
        "rateOfReturn": null,
        "retirementAge": 70,
        "monthlyRetirementAmount": null,
        "inBudget": null,
        "startDate": null,
        "dateOfBirth": null,
        "currentAmount": null,
        "percentComplete": null,
        "saveNewGoal": true,
        "financialGoalAccounts": null
    }
}-!|
|POST||200|||

'''1.1.1.6 financialGoalName, financialGoalType (other), retirementAge, financialGoalAmount set to not null'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": "Test financialGoalName",
        "financialGoalType": "financial.goal.other",
        "dateNeeded": null,
        "createdDate": null,
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 5000
            }
        }, 
        "monthlyAmount": null,
        "startAmount": null,
        "rateOfReturn": null,
        "retirementAge": 70,
        "monthlyRetirementAmount": null,
        "inBudget": null,
        "startDate": null,
        "dateOfBirth": null,
        "currentAmount": null,
        "percentComplete": null,
        "saveNewGoal": true,
        "financialGoalAccounts": null
    }
}-!|
|POST||400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-ErrorCode: 200002 - Argument goalDetailDTOToSave-dateNeeded is undefined but is required.-!|true|

'''1.1.1.7 financialGoalName, financialGoalType (other), retirementAge, financialGoalAmount, dateNeeded set to not null'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": "Test financialGoalName-2",
        "financialGoalType": "financial.goal.other",
        "dateNeeded": {
            "Date": {
                "year": 2013, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/2013"
            }
        }, 
        "createdDate": null,
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 5000
            }
        }, 
        "monthlyAmount": null,
        "startAmount": null,
        "rateOfReturn": null,
        "retirementAge": 70,
        "monthlyRetirementAmount": null,
        "inBudget": null,
        "startDate": null,
        "dateOfBirth": null,
        "currentAmount": null,
        "percentComplete": null,
        "saveNewGoal": true,
        "financialGoalAccounts": null
    }
}-!|
|POST||200|||
|let|$retirementFG3|js|!-response.jsonbody.FinancialGoalDetailItem.id-!||

'''1.1.1.8 retirement: retirementAge set to null, dateOfBirth set to null'''

!*****>  '''Calculation'''

!|Query|!- select count(*)+1 as t from [FINANCIAL_GOAL]-!|
|t?|
|>>totalFinancialGoal|

!|Query|!-select CONVERT(decimal(10,2),(select AVAILABLE_BALANCE*80/100 from [OLB_ACCOUNT] where ACCOUNT_ID = -!@account1!-) +
         (select AVAILABLE_BALANCE*10/100 from [OLB_ACCOUNT] where ACCOUNT_ID = -!@account2!-)) as currentAmount-!|
|currentAmount?|
|>>currentAmount|

!|Query|!-select CONVERT(decimal(10,0),(-!@currentAmount!-*100/5000)) as percentComplete-!|
|percentComplete?|
|>>percentComplete|

!|Query|!-select CONVERT(decimal(10,2),((5000--!@currentAmount!-)*((100.00-7)/100.00))/(65*12)) as monthlyAmount-!|
|monthlyAmount?|
|>>monthlyAmount|

!|Query|!-select  (CASE WHEN DAY(DATEADD(YEAR, 65, GETDATE())) = 1 THEN '1.0' else CONVERT(varchar, DAY(DATEADD(YEAR, 65, GETDATE())))  END) as dNeeded,
          (CASE WHEN MONTH(DATEADD(YEAR, 65, GETDATE())) = 1 THEN '1.0' else CONVERT(varchar, MONTH(DATEADD(YEAR, 65, GETDATE())))  END) as mNeeded,
           YEAR(DATEADD(YEAR, 65, GETDATE())) as yNeeded-!|
|dNeeded?|mNeeded?|yNeeded?|
|>>dNeeded|>>mNeeded|>>yNeeded|

****!

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|comment|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": "thisfinancialGoalNameCreatedByFitTest1",
        "financialGoalType": "financial.goal.retirement",
       "dateNeeded": null,
        "createdDate": {
            "Date": {
                "year": 2013, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/2013"
            }
        }, 
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 5000
            }
        },
        "monthlyAmount": null,
        "startAmount": null,
        "rateOfReturn": 7,
        "retirementAge": 65,
        "monthlyRetirementAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 450.50
            }
        },
        "inBudget": true,
        "startDate": null,
        "dateOfBirth": null,
        "currentAmount": null,
        "percentComplete": 12,
        "financialGoalAccounts": [
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID1%!-,
                    "percentage": 80
                }
            },
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID2%!-,
                    "percentage": 10
                }
            }
        ],
        "saveNewGoal": true
    }
}-!|
|POST||200|||
|let|$retirementFG1|js|!-response.jsonbody.FinancialGoalDetailItem.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalName-!|!-thisfinancialGoalNameCreatedByFitTest1-!|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalType-!|financial.goal.retirement|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.year-!|%yNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.month-!|%mNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.day-!|%dNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.year-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.month-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.day-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.value-!|5000|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.value-!|%monthlyAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.value-!|%currentAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.rateOfReturn-!|7|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.retirementAge-!|65|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.value-!|450.5|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.inBudget-!|true|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.year-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.month-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.day-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.year-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.month-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.day-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.value-!|%currentAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.percentComplete-!|%percentComplete%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.saveNewGoal-!|true|
|let|$retirementFinancialGoalAccount1|js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.financialGoalId-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.percentage-!|80|
|let|$retirementFinancialGoalAccount2|js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.financialGoalId-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.percentage-!|10|

!|Query|!- select count(*) as t from [FINANCIAL_GOAL]-!|
|t?|
|<<totalFinancialGoal|

'''1.1.1.9 financialGoalName is already used by another in-budget goal'''

!|Query|!- select count(*)+1 as t from [FINANCIAL_GOAL]-!|
|t?|
|>>totalFinancialGoal|

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": "thisfinancialGoalNameCreatedByFitTest25",
        "financialGoalType": "financial.goal.retirement",
       "dateNeeded": null,
        "createdDate": {
            "Date": {
                "year": 2013, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/2013"
            }
        }, 
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 5000
            }
        },
        "monthlyAmount": null,
        "startAmount": null,
        "rateOfReturn": 7,
        "retirementAge": 65,
        "monthlyRetirementAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 450.50
            }
        },
        "inBudget": true,
        "startDate": null,
        "dateOfBirth": null,
        "currentAmount": null,
        "percentComplete": 12,
        "financialGoalAccounts": [
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID1%!-,
                    "percentage": 80
                }
            },
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID2%!-,
                    "percentage": 10
                }
            }
        ],
        "saveNewGoal": true
    }
}-!|
|POST||200|||
|let|$retirementFG4|js|!-response.jsonbody.FinancialGoalDetailItem.id-!||

!|Query|!- select count(*) as t from [FINANCIAL_GOAL]-!|
|t?|
|<<totalFinancialGoal|

'''1.1.1.10 retirement: dateOfBirth set to 01/01/1070'''


|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|comment|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": "thisfinancialGoalNameCreatedByFitTest2",
        "financialGoalType": "financial.goal.retirement",
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 5000
            }
        },
        "monthlyAmount": null,
        "startAmount": null,
        "rateOfReturn": 7,
        "retirementAge": 70,
        "monthlyRetirementAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 450.50
            }
        },
        "inBudget": true,
        "startDate": null,
        "dateOfBirth": {
            "Date": {
                "year": 1070, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/1070"
            }
        }, 
        "currentAmount": null,
        "percentComplete": 12,
        "financialGoalAccounts": null,
        "saveNewGoal": true
    }
}-!|
|POST||500|||
|comment|APDB-321|

'''1.1.1.11 retirement: retirementAge set to not null, dateOfBirth set to not null'''


!*****>  '''Calculation'''

!|Query|!- select count(*)+1 as t from [FINANCIAL_GOAL]-!|
|t?|
|>>totalFinancialGoal|

!|Query|!-select CONVERT(decimal(10,2),(select AVAILABLE_BALANCE*80/100 from [OLB_ACCOUNT] where ACCOUNT_ID = -!@account1!-) +
         (select AVAILABLE_BALANCE*10/100 from [OLB_ACCOUNT] where ACCOUNT_ID = -!@account2!-)) as currentAmount-!|
|currentAmount?|
|>>currentAmount|

!|Query|!-select CONVERT(decimal(10,0),(-!@currentAmount!-*100/5000)) as percentComplete-!|
|percentComplete?|
|>>percentComplete|

!|Query|!-select  (CASE WHEN DAY(DATEADD(YEAR, 70, '1980-3-31')) = 1 THEN '1.0' else CONVERT(varchar, DAY(DATEADD(YEAR, 70, '1980-3-31')))  END) as dNeeded,
          (CASE WHEN MONTH(DATEADD(YEAR, 70, '1980-3-31')) = 1 THEN '1.0' else CONVERT(varchar, MONTH(DATEADD(YEAR, 70, '1980-3-31')))  END) as mNeeded,
           YEAR(DATEADD(YEAR, 70, '1980-3-31')) as yNeeded-!|
|dNeeded?|mNeeded?|yNeeded?|
|>>dNeeded|>>mNeeded|>>yNeeded|

!|Query|!-select CONVERT(decimal(10,2),((5000--!@currentAmount!-)*((100.00-7)/100.00))/((DATEDIFF(MONTH, GETDATE(), DATEADD(YEAR, 70, '1980-3-31'))))) as monthlyAmount-!|
|monthlyAmount?|
|>>monthlyAmount|

****!

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|comment|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": "thisfinancialGoalNameCreatedByFitTest2",
        "financialGoalType": "financial.goal.retirement",
       "dateNeeded": null,
        "createdDate": {
            "Date": {
                "year": 2013, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/2013"
            }
        }, 
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 5000
            }
        },
        "monthlyAmount": null,
        "startAmount": null,
        "rateOfReturn": 7,
        "retirementAge": 70,
        "monthlyRetirementAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 450.50
            }
        },
        "inBudget": true,
        "startDate": null,
        "dateOfBirth": {
            "Date": {
                "year": 1980, 
                "month": 3, 
                "day": 31, 
                "displayValue": "03/31/1980"
            }
        }, 
        "currentAmount": null,
        "percentComplete": 12,
        "financialGoalAccounts": [
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID1%!-,
                    "percentage": 80
                }
            },
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID2%!-,
                    "percentage": 10
                }
            }
        ],
        "saveNewGoal": true
    }
}-!|
|POST||200|||
|let|$retirementFG2|js|!-response.jsonbody.FinancialGoalDetailItem.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalName-!|!-thisfinancialGoalNameCreatedByFitTest2-!|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalType-!|financial.goal.retirement|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.year-!|%yNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.month-!|%mNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.day-!|%dNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.year-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.month-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.day-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.value-!|5000|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.precision-!||
|let|$mAmount|js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.value-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.value-!|%currentAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.rateOfReturn-!|7|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.retirementAge-!|70|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.value-!|450.5|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.inBudget-!|true|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.year-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.month-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.day-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.year-!|1980|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.month-!|3|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.day-!|31|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.displayValue-!|03/31/1980|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.value-!|%currentAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.percentComplete-!|%percentComplete%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.saveNewGoal-!|true|
|let|$retirementFinancialGoalAccount3|js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.financialGoalId-!|%retirementFG2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.percentage-!|80|
|let|$retirementFinancialGoalAccount4|js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.financialGoalId-!|%retirementFG2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.percentage-!|10|

!|Query|!-SELECT CAST(
             CASE 
                  WHEN (-!@monthlyAmount!- - -!@mAmount!-) < 1
                     THEN 'passed'
                  ELSE 'failed'
             END AS char) as monthlyAmountCheck-!|
|monthlyAmountCheck?|
|>>monthlyAmount|


!|Query|!- select count(*) as t from [FINANCIAL_GOAL]-!|
|t?|
|<<totalFinancialGoal|

'''1.1.1.12 other: retirementAge set to not null, monthlyRetirementAmount set to not null, startDate set to null '''

!*****>  '''Calculation'''

!|Query|!- select count(*)+1 as t from [FINANCIAL_GOAL]-!|
|t?|
|>>totalFinancialGoal|

!|Query|!-select CONVERT(decimal(10,2),(select AVAILABLE_BALANCE*80/100 from [OLB_ACCOUNT] where ACCOUNT_ID = -!@account1!-) +
         (select AVAILABLE_BALANCE*10/100 from [OLB_ACCOUNT] where ACCOUNT_ID = -!@account2!-)) as currentAmount-!|
|currentAmount?|
|>>currentAmount|

!|Query|!-select CONVERT(decimal(10,0),(-!@currentAmount!-*100/5000)) as percentComplete-!|
|percentComplete?|
|>>percentComplete|

!|Query|!-select  (CASE WHEN DAY(DATEADD(YEAR, 65, '1980-3-31')) = 1 THEN '1.0' else CONVERT(varchar, DAY(DATEADD(YEAR, 65, '1980-3-31')))  END) as dNeeded,
          (CASE WHEN MONTH(DATEADD(YEAR, 65, '1980-3-31')) = 1 THEN '1.0' else CONVERT(varchar, MONTH(DATEADD(YEAR, 65, '1980-3-31')))  END) as mNeeded,
           YEAR(DATEADD(YEAR, 65, '1980-3-31')) as yNeeded-!|
|dNeeded?|mNeeded?|yNeeded?|
|>>dNeeded|>>mNeeded|>>yNeeded|

!|Query|!-select CONVERT(decimal(10,2),((5000--!@currentAmount!-)*((100.00-7)/100.00))/((DATEDIFF(month, GETDATE(), '2020-2-2'))-1)) as monthlyAmount-!|
|monthlyAmount?|
|>>monthlyAmount|

****!

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|comment|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": "thisfinancialGoalNameCreatedByFitTest3",
        "financialGoalType": "financial.goal.other",
        "dateNeeded": {
            "Date": {
                "year": 2020, 
                "month": 2, 
                "day": 2, 
                "displayValue": "02/02/2020"
            }
        }, 
        "createdDate": {
            "Date": {
                "year": 2013, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/2013"
            }
        }, 
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 5000
            }
        },
        "monthlyAmount": null,
        "startAmount": null,
        "rateOfReturn": 7,
        "retirementAge": 70,
        "monthlyRetirementAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 450.50
            }
        },
        "inBudget": true,
        "startDate": null,
        "dateOfBirth": {
            "Date": {
                "year": 1970, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/1970"
            }
        }, 
        "currentAmount": null,
        "percentComplete": 12,
        "financialGoalAccounts": [
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID1%!-,
                    "percentage": 80
                }
            },
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID2%!-,
                    "percentage": 10
                }
            }
        ],
        "saveNewGoal": true
    }
}-!|
|POST||200|||
|let|$otherFG1|js|!-response.jsonbody.FinancialGoalDetailItem.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalName-!|!-thisfinancialGoalNameCreatedByFitTest3-!|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalType-!|financial.goal.other|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.year-!|2020|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.month-!|2|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.day-!|2|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.displayValue-!|02/02/2020|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.value-!|5000|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.precision-!||
|let|$mAmount|js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.value-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.value-!|%currentAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.rateOfReturn-!|7|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.retirementAge-!|0.0|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.value-!|0.0|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.inBudget-!|true|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.year-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.month-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.day-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.value-!|%currentAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.percentComplete-!|%percentComplete%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.saveNewGoal-!|true|
|let|$otherFinancialGoalAccount1|js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.financialGoalId-!|%otherFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.percentage-!|80|
|let|$otherFinancialGoalAccount2|js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.financialGoalId-!|%otherFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.percentage-!|10|

!|Query|!-SELECT CAST(
             CASE 
                  WHEN (-!@monthlyAmount!- - -!@mAmount!-) < 1
                     THEN 'passed'
                  ELSE 'failed'
             END AS char) as monthlyAmountCheck-!|
|monthlyAmountCheck?|
|>>monthlyAmount|

!|Query|!- select count(*) as t from [FINANCIAL_GOAL]-!|
|t?|
|<<totalFinancialGoal|

'''1.1.1.13 re-create with same data with existing one'''

!|Query|!- select count(*)+1 as t from [FINANCIAL_GOAL]-!|
|t?|
|>>totalFinancialGoal|

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|comment|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": "thisfinancialGoalNameCreatedByFitTest3",
        "financialGoalType": "financial.goal.other",
        "dateNeeded": {
            "Date": {
                "year": 2020, 
                "month": 2, 
                "day": 2, 
                "displayValue": "02/02/2020"
            }
        }, 
        "createdDate": {
            "Date": {
                "year": 2013, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/2013"
            }
        }, 
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 5000
            }
        },
        "monthlyAmount": null,
        "startAmount": null,
        "rateOfReturn": 7,
        "retirementAge": 70,
        "monthlyRetirementAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 450.50
            }
        },
        "inBudget": false,
        "startDate": null,
        "dateOfBirth": {
            "Date": {
                "year": 1970, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/1970"
            }
        }, 
        "currentAmount": null,
        "percentComplete": 12,
        "financialGoalAccounts": [
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID1%!-,
                    "percentage": 80
                }
            },
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID2%!-,
                    "percentage": 10
                }
            }
        ],
        "saveNewGoal": true
    }
}-!|
|POST||200|||
|let|$retirementFG5|js|!-response.jsonbody.FinancialGoalDetailItem.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalName-!|!-thisfinancialGoalNameCreatedByFitTest3-!|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalType-!|financial.goal.other|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.year-!|2020|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.month-!|2|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.day-!|2|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.precision-!|2|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.value-!|5000|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.value-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.value-!|%currentAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.rateOfReturn-!|7|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.retirementAge-!|0.0|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.value-!|0.0|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.inBudget-!|false|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.value-!|%currentAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.percentComplete-!|%percentComplete%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.saveNewGoal-!|true|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.financialGoalId-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.percentage-!|80|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.financialGoalId-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.percentage-!|10|

!|Query|!- select count(*) as t from [FINANCIAL_GOAL]-!|
|t?|
|<<totalFinancialGoal|

'''1.1.1.14 retirement: startDate is before than dateNeeded'''

!|Query|!- select count(*)+1 as t from [FINANCIAL_GOAL]-!|
|t?|
|>>totalFinancialGoal|


|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|comment|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": "thisfinancialGoalNameCreatedByFitTest12",
        "financialGoalType": "financial.goal.retirement",
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 5000
            }
        },
        "rateOfReturn": 7,
        "retirementAge": 30,
        "monthlyRetirementAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 450.50
            }
        },
        "inBudget": true,
        "startDate": {
            "Date": {
                "year": 2050, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/2050"
            }
        }, 
        "dateOfBirth": {
            "Date": {
                "year": 2013, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/2013"
            }
        }, 
        "financialGoalAccounts": [
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID1%!-,
                    "percentage": 80
                }
            },
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID2%!-,
                    "percentage": 10
                }
            }
        ],
        "saveNewGoal": true
    }
}-!|
|POST||200|||
|comment|APDB-323|
|let|$fGoal3|js|!-response.jsonbody.FinancialGoalDetailItem.id-!||

!|Query|!- select count(*) as t from [FINANCIAL_GOAL]-!|
|t?|
|<<totalFinancialGoal|


'''1.1.1.15 other: rateOfReturn set to null'''

!|Query|!- select count(*)+1 as t from [FINANCIAL_GOAL]-!|
|t?|
|>>totalFinancialGoal|


|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|comment|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "dateNeeded": {
            "Date": {
                "year": 2020, 
                "month": 2, 
                "day": 2, 
                "displayValue": "02/02/2020"
            }
        }, 
        "financialGoalName": "thisfinancialGoalNameCreatedByFitTest13",
        "financialGoalType": "financial.goal.other",
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 5000
            }
        },
        "rateOfReturn": 0,
        "retirementAge": 30,
        "monthlyRetirementAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 450.50
            }
        },
        "inBudget": true,
        "startDate": null, 
        "dateOfBirth": {
            "Date": {
                "year": 2013, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/2013"
            }
        }, 
        "financialGoalAccounts": [
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID1%!-,
                    "percentage": 80
                }
            },
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID2%!-,
                    "percentage": 10
                }
            }
        ],
        "saveNewGoal": true
    }
}-!|
|POST||200|||
|let|$fGoal4|js|!-response.jsonbody.FinancialGoalDetailItem.id-!||

!|Query|!- select count(*) as t from [FINANCIAL_GOAL]-!|
|t?|
|<<totalFinancialGoal|

'''1.1.1.16 other: startDate = dateNeeded'''

!|Query|!- select count(*)+1 as t from [FINANCIAL_GOAL]-!|
|t?|
|>>totalFinancialGoal|

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|comment|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "financialGoalName": "thisfinancialGoalNameCreatedByFitTest12",
        "financialGoalType": "financial.goal.other",
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 5000
            }
        },
        "rateOfReturn": 7,
        "retirementAge": 30,
        "monthlyRetirementAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 450.50
            }
        },
        "inBudget": false,
        "dateNeeded": {
            "Date": {
                "year": 2020, 
                "month": 2, 
                "day": 2, 
                "displayValue": "02/02/2020"
            }
        }, 
        "startDate": {
            "Date": {
                "year": 2020, 
                "month": 2, 
                "day": 2, 
                "displayValue": "02/02/2020"
            }
        }, 
        "dateOfBirth": {
            "Date": {
                "year": 2013, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/2013"
            }
        }, 
        "financialGoalAccounts": [
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID1%!-,
                    "percentage": 80
                }
            },
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": -!%userAccJoinID2%!-,
                    "percentage": 10
                }
            }
        ],
        "saveNewGoal": true
    }
}-!|
|POST||200|||
|let|$fGoal5|js|!-response.jsonbody.FinancialGoalDetailItem.id-!||


!|Query|!- select count(*) as t from [FINANCIAL_GOAL]-!|
|t?|
|<<totalFinancialGoal|

'''1.1.1.17 invalid userAccountJoinId'''


|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null,
        "dateNeeded": {
            "Date": {
                "year": 2013, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/2013"
            }
        }, 
        "financialGoalName": "thisfinancialGoalNameCreatedByFitTest50",
        "financialGoalType": "financial.goal.other",
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD",
                "precision": 2,
                "value": 5000
            }
        },
        "financialGoalAccounts": [
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": 123,
                    "percentage": 80
                }
            },
            {
                "FinancialGoalAccount": {
                    "id": null,
                    "financialGoalId": null,
                    "userAccountJoinId": 123,
                    "percentage": 10
                }
            }
        ],
        "saveNewGoal": true
    }
}-!|
|POST||400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-ErrorCode: 200804 - Financial goal references a user account that does not exist-!|true|

****!
****!
!*****> '''1.2 PUT FINANCIAL GOAL'''
!*****> '''1.2.1 PUT FINANCIAL GOAL (/financialgoals//{goalId})'''

'''1.2.1.1 different user tries to update the financial goal'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null, 
        "financialGoalName": null, 
        "financialGoalType": null, 
        "dateNeeded": null, 
        "createdDate": null, 
        "financialGoalAmount": null, 
        "monthlyAmount": null, 
        "startAmount": null, 
        "rateOfReturn": null, 
        "retirementAge": null, 
        "monthlyRetirementAmount": null, 
        "inBudget": null, 
        "startDate": null, 
        "dateOfBirth": null, 
        "currentAmount": null, 
        "percentComplete": null, 
        "saveNewGoal": null, 
        "financialGoalAccounts": null
    }
}-!|
|PUT|/%retirementFG1%|403|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-Security Error - ErrorCode: 20022 - User does not own this Financial Goal-!|true|

'''1.2.1.2 update to null values'''

!|Query|!- select count(*) as t from [FINANCIAL_GOAL]-!|
|t?|
|>>totalFinancialGoal|

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null, 
        "financialGoalName": null, 
        "financialGoalType": null, 
        "dateNeeded": null, 
        "createdDate": null, 
        "financialGoalAmount": null, 
        "monthlyAmount": null, 
        "startAmount": null, 
        "rateOfReturn": null, 
        "retirementAge": null, 
        "monthlyRetirementAmount": null, 
        "inBudget": null, 
        "startDate": null, 
        "dateOfBirth": null, 
        "currentAmount": null, 
        "percentComplete": null, 
        "saveNewGoal": null, 
        "financialGoalAccounts": null
    }
}-!|
|PUT|/%retirementFG1%|400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-ErrorCode: 200002 - Argument goalDetailDTOToSave-financialGoalName is undefined but is required.-!|true|

!|Query|!- select count(*) as t from [FINANCIAL_GOAL]-!|
|t?|
|<<totalFinancialGoal|

'''1.2.1.3 invalid id in the JSON'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": 12333, 
        "financialGoalName": "Fit Test Updated By Fit",    
        "financialGoalType": "financial.goal.other",
        "dateNeeded": {
            "Date": {
                "year": 2013, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/2013"
            }
        }, 
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 5000
            }
        }, 
        "retirementAge": 70
    }
}-!|
|PUT|/%retirementFG1%|200|||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.id-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalName-!|!-Fit Test Updated By Fit-!|

!|Query|!- select count(*) as t from [FINANCIAL_GOAL]-!|
|t?|
|<<totalFinancialGoal|


'''1.2.1.4 invalid id in the URL'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "id": null, 
        "financialGoalName": "Fit Test Updated By Fit"
    }
}-!|
|PUT|/123|400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-ErrorCode: 200800 - Goal was not found for given goal id and user.-!|true|

!|Query|!- select count(*) as t from [FINANCIAL_GOAL]-!|
|t?|
|<<totalFinancialGoal|

'''1.2.1.5 update all'''

!*****>  '''Calculation'''

!|Query|!-select CONVERT(decimal(10,2),(select AVAILABLE_BALANCE*15/100 from [OLB_ACCOUNT] where ACCOUNT_ID = -!@account1!-) +
         (select AVAILABLE_BALANCE*12/100 from [OLB_ACCOUNT] where ACCOUNT_ID = -!@account2!-)) as currentAmount-!|
|currentAmount?|
|>>currentAmount2|

!|Query|!-select CONVERT(decimal(10,0),(-!@currentAmount2!-*100/4000))-1 as percentComplete-!|
|percentComplete?|
|>>percentComplete|

!|Query|!-select CONVERT(decimal(10,1),((4000--!@currentAmount2!-)*((100.00-10)/100.00))/((DATEDIFF(MONTH, DATEADD(YEAR, 0, '12/10/2012'), DATEADD(YEAR, 60, '11/11/1986'))))) as monthlyAmount-!|
|monthlyAmount?|
|>>monthlyAmount|

!|Query|!-select  (CASE WHEN DAY(DATEADD(YEAR, 60, '11/11/1986')) = 1 THEN '1.0' else CONVERT(varchar, DAY(DATEADD(YEAR, 60, '11/11/1986')))  END) as dNeeded,
          (CASE WHEN MONTH(DATEADD(YEAR, 60, '11/11/1986')) = 1 THEN '1.0' else CONVERT(varchar, MONTH(DATEADD(YEAR, 60, '11/11/1986')))  END) as mNeeded,
           YEAR(DATEADD(YEAR, 60, '11/11/1986')) as yNeeded-!|
|dNeeded?|mNeeded?|yNeeded?|
|>>dNeeded|>>mNeeded|>>yNeeded|

****!

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "financialGoalName": "updatedfinancialGoalName1", 
        "financialGoalType": "financial.goal.retirement", 
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 4000
            }
        }, 
        "startAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 300.55
            }
        }, 
        "rateOfReturn": 10, 
        "retirementAge": 60, 
        "monthlyRetirementAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 470.42
            }
        }, 
        "inBudget": false,  
        "startDate": {
            "Date": {
                "year": 2012, 
                "month": 12, 
                "day": 10, 
                "displayValue": "12/10/2012"
            }
        }, 
        "dateOfBirth":  {
            "Date": {
                "year": 1986, 
                "month": 11, 
                "day": 11, 
                "displayValue": "11/11/1986"
            }
        }, 
        "financialGoalAccounts": [
            {
                "FinancialGoalAccount": {
                    "userAccountJoinId": -!%userAccJoinID1%!-, 
                    "percentage": 15
                }
            }, 
            {
                "FinancialGoalAccount": {

                    "userAccountJoinId": -!%userAccJoinID2%!-, 
                    "percentage": 12
                }
            }
        ], 
        "saveNewGoal": true
    }
}
-!|
|PUT|/%retirementFG1%|200|||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.id-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalName-!|!-updatedfinancialGoalName1-!|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalType-!|financial.goal.retirement|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.year-!|%yNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.month-!|%mNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.day-!|%dNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.value-!|4000|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.value-!|%monthlyAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.value-!|%currentAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.rateOfReturn-!|10|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.retirementAge-!|60|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.value-!|470.42|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.inBudget-!|false|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.year-!|2012|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.month-!|12|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.day-!|10|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.displayValue-!|12/10/2012|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.year-!|1986|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.month-!|11|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.day-!|11|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.displayValue-!|11/11/1986|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.value-!|%currentAmount2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.percentComplete-!|%percentComplete%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.saveNewGoal-!|true|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.financialGoalId-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.percentage-!|15|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.financialGoalId-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.percentage-!|12|

!|Query|!- select count(*) as t from [FINANCIAL_GOAL]-!|
|t?|
|<<totalFinancialGoal|

'''1.2.1.6 update financialGoalType'''

!*****>  '''Calculation'''
!|Query|!-select CONVERT(decimal(10,2),((4000--!@currentAmount2!-)*((100.00-10)/100.00))/((DATEDIFF(MONTH, DATEADD(YEAR, 0, '12/10/2012'), DATEADD(YEAR, 0, '11/11/2020'))))) as monthlyAmount-!|
|monthlyAmount?|
|>>monthlyAmount2|
****!

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "financialGoalName": "updatedfinancialGoalName1", 
        "financialGoalType": "financial.goal.other",
        "dateNeeded": {
            "Date": {
                "year": 2020, 
                "month": 11, 
                "day": 11, 
                "displayValue": "12/10/2020"
            }
        },  
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 4000
            }
        }, 
        "startAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 300.55
            }
        }, 
        "rateOfReturn": 10, 
        "retirementAge": 60, 
        "monthlyRetirementAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 470.42
            }
        }, 
        "inBudget": false,  
        "startDate": {
            "Date": {
                "year": 2012, 
                "month": 12, 
                "day": 10, 
                "displayValue": "12/10/2012"
            }
        }, 
        "dateOfBirth":  {
            "Date": {
                "year": 1986, 
                "month": 11, 
                "day": 11, 
                "displayValue": "11/11/1986"
            }
        }, 
        "financialGoalAccounts": [
            {
                "FinancialGoalAccount": {
                    "userAccountJoinId": -!%userAccJoinID1%!-, 
                    "percentage": 15
                }
            }, 
            {
                "FinancialGoalAccount": {

                    "userAccountJoinId": -!%userAccJoinID2%!-, 
                    "percentage": 12
                }
            }
        ], 
        "saveNewGoal": true
    }
}
-!|
|PUT|/%retirementFG1%|200|||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.id-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalName-!|!-updatedfinancialGoalName1-!|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalType-!|financial.goal.other|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.year-!|2020|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.month-!|11|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.day-!|11|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.displayValue-!|11/11/2020|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.value-!|4000|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.value-!|%monthlyAmount2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.value-!|%currentAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.rateOfReturn-!|10|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.retirementAge-!|0.0|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.value-!|0.0|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.inBudget-!|false|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.year-!|2012|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.month-!|12|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.day-!|10|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.displayValue-!|12/10/2012|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.year-!|1986|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.month-!|11|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.day-!|11|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.displayValue-!|11/11/1986|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.value-!|%currentAmount2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.percentComplete-!|%percentComplete%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.saveNewGoal-!|true|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.financialGoalId-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.percentage-!|15|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.financialGoalId-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.percentage-!|12|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "financialGoalName": "updatedfinancialGoalName1", 
        "financialGoalType": "financial.goal.retirement", 
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 4000
            }
        }, 
        "startAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 300.55
            }
        }, 
        "rateOfReturn": 10, 
        "retirementAge": 60, 
        "monthlyRetirementAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 470.42
            }
        }, 
        "inBudget": false,  
        "startDate": {
            "Date": {
                "year": 2012, 
                "month": 12, 
                "day": 10, 
                "displayValue": "12/10/2012"
            }
        }, 
        "dateOfBirth":  {
            "Date": {
                "year": 1986, 
                "month": 11, 
                "day": 11, 
                "displayValue": "11/11/1986"
            }
        }, 
        "financialGoalAccounts": [
            {
                "FinancialGoalAccount": {
                    "userAccountJoinId": -!%userAccJoinID1%!-, 
                    "percentage": 15
                }
            }, 
            {
                "FinancialGoalAccount": {

                    "userAccountJoinId": -!%userAccJoinID2%!-, 
                    "percentage": 12
                }
            }
        ], 
        "saveNewGoal": true
    }
}
-!|
|PUT|/%retirementFG1%|200|||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.id-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalName-!|!-updatedfinancialGoalName1-!|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalType-!|financial.goal.retirement|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.year-!|%yNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.month-!|%mNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.day-!|%dNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.value-!|4000|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.value-!|%monthlyAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.value-!|%currentAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.rateOfReturn-!|10|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.retirementAge-!|60|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.value-!|470.42|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.inBudget-!|false|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.year-!|2012|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.month-!|12|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.day-!|10|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.displayValue-!|12/10/2012|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.year-!|1986|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.month-!|11|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.day-!|11|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.displayValue-!|11/11/1986|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.value-!|%currentAmount2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.percentComplete-!|%percentComplete%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.saveNewGoal-!|true|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.financialGoalId-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.percentage-!|15|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.financialGoalId-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[1].FinancialGoalAccount.percentage-!|12|

'''1.2.1.7 remove financialGoalAccount'''

!*****>  '''Calculation'''

!|Query|!-select CONVERT(decimal(10,0),(select AVAILABLE_BALANCE*15/100 from [OLB_ACCOUNT] where ACCOUNT_ID = -!@account1!-)) as currentAmount-!|
|currentAmount?|
|>>currentAmount2|

!|Query|!-select CONVERT(decimal(10,0),(-!@currentAmount2!-*100/4000)) as percentComplete-!|
|percentComplete?|
|>>percentComplete|

!|Query|!-select CONVERT(decimal(10,2),((4000--!@currentAmount2!-)*((100.00-10)/100.00))/((DATEDIFF(MONTH, DATEADD(YEAR, 0, '12/10/2012'), DATEADD(YEAR, 60, '11/11/1986'))))) as monthlyAmount-!|
|monthlyAmount?|
|>>monthlyAmount|

!|Query|!-select  (CASE WHEN DAY(DATEADD(YEAR, 60, '11/11/1986')) = 1 THEN '1.0' else CONVERT(varchar, DAY(DATEADD(YEAR, 60, '11/11/1986')))  END) as dNeeded,
          (CASE WHEN MONTH(DATEADD(YEAR, 60, '11/11/1986')) = 1 THEN '1.0' else CONVERT(varchar, MONTH(DATEADD(YEAR, 60, '11/11/1986')))  END) as mNeeded,
           YEAR(DATEADD(YEAR, 60, '11/11/1986')) as yNeeded-!|
|dNeeded?|mNeeded?|yNeeded?|
|>>dNeeded|>>mNeeded|>>yNeeded|

****!

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "financialGoalName": "updatedfinancialGoalName1", 
        "financialGoalType": "financial.goal.retirement", 
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 4000
            }
        }, 
        "startAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 300.55
            }
        }, 
        "rateOfReturn": 10, 
        "retirementAge": 60, 
        "monthlyRetirementAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 470.42
            }
        }, 
        "inBudget": false,  
        "startDate": {
            "Date": {
                "year": 2012, 
                "month": 12, 
                "day": 10, 
                "displayValue": "12/10/2012"
            }
        }, 
        "dateOfBirth":  {
            "Date": {
                "year": 1986, 
                "month": 11, 
                "day": 11, 
                "displayValue": "11/11/1986"
            }
        }, 
        "financialGoalAccounts": [
            {
                "FinancialGoalAccount": {
                    "userAccountJoinId": -!%userAccJoinID1%!-, 
                    "percentage": 15
                }
            }
        ], 
        "saveNewGoal": true
    }
}
-!|
|PUT|/%retirementFG1%|200|||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.id-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalName-!|!-updatedfinancialGoalName1-!|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalType-!|financial.goal.retirement|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.year-!|%yNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.month-!|%mNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.day-!|%dNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.value-!|4000|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.value-!|%monthlyAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.value-!|%currentAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.rateOfReturn-!|10|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.retirementAge-!|60|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.value-!|470.42|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.inBudget-!|false|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.year-!|2012|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.month-!|12|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.day-!|10|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.displayValue-!|12/10/2012|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.year-!|1986|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.month-!|11|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.day-!|11|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.displayValue-!|11/11/1986|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.value-!|%currentAmount2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.percentComplete-!|%percentComplete%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.saveNewGoal-!|true|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.financialGoalId-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.percentage-!|15|

!|Query|!- select count(*) as t from [FINANCIAL_GOAL]-!|
|t?|
|<<totalFinancialGoal|

'''1.2.1.10 saveNewGoal set to false'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "financialGoalName": "saveNewGoal set to false test", 
        "financialGoalType": "financial.goal.other", 
        "dateNeeded": {
            "Date": {
                "year": 2013, 
                "month": 1, 
                "day": 1, 
                "displayValue": "01/01/2013"
            }
        }, 
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 5000
            }
        }, 
        "retirementAge": 70,
        "saveNewGoal": false
    }
}
-!|
|PUT|/%retirementFG2%|200|||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.id-!|%retirementFG2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalName-!|!-saveNewGoal set to false test-!|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.saveNewGoal-!|false|

'''1.2.1.11 startDate > dateNeeded'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|setBody|!-{
    "FinancialGoalDetailItem": {
        "financialGoalName": "updatedfinancialGoalName2", 
        "financialGoalType": "financial.goal.other", 
        "financialGoalAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 4000
            }
        }, 
        "startAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 300.55
            }
        }, 
        "rateOfReturn": 10, 
        "retirementAge": 60, 
        "monthlyRetirementAmount": {
            "Money": {
                "currencyCode": "USD", 
                "precision": 2, 
                "value": 470.42
            }
        }, 
        "inBudget": false, 
        "dateNeeded": {
            "Date": {
                "year": 2012, 
                "month": 12, 
                "day": 10, 
                "displayValue": "12/10/2012"
            }
        },  
        "startDate": {
            "Date": {
                "year": 2020, 
                "month": 12, 
                "day": 10, 
                "displayValue": "12/10/2020"
            }
        }, 
        "dateOfBirth":  {
            "Date": {
                "year": 1986, 
                "month": 11, 
                "day": 11, 
                "displayValue": "11/11/1986"
            }
        }
    }
}
-!|
|PUT|/%retirementFG2%|200|||
****!
****!
!*****> '''1.3 GET FINANCIAL GOAL'''
!*****> '''1.3.1 GET FINANCIAL GOAL (/financialgoals//summary)'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|comment|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|GET|/summary|200|||
|let||js|response.jsonbody[0].goalName|!-Test financialGoalName-1-!|
|let||js|response.jsonbody[1].goalName|!-Test financialGoalName-2-!|
|let||js|response.jsonbody[2].goalName|!-updatedfinancialGoalName1-!|
|let||js|response.jsonbody[3].goalName|!-thisfinancialGoalNameCreatedByFitTest25-!|
|let||js|response.jsonbody[4].goalName|!-updatedfinancialGoalName2-!|
|let||js|response.jsonbody[5].goalName|!-thisfinancialGoalNameCreatedByFitTest3-!|
|let||js|response.jsonbody[2].percentComplete|9|
|let||js|response.jsonbody[2].current.Money.currencyCode|USD|
|let||js|response.jsonbody[2].current.Money.precision|2|
|let||js|response.jsonbody[2].current.Money.value|375|
|let||js|response.jsonbody[2].goal.Money.currencyCode|USD|
|let||js|response.jsonbody[2].goal.Money.precision|2|
|let||js|response.jsonbody[2].goal.Money.value|4000|
****!
!*****> '''1.3.2 GET FINANCIAL GOAL (/financialgoals/)'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|GET||200|||
|let||js|!-response.jsonbody[1].id-!||
|let||js|!-response.jsonbody[1].financialGoalName-!||
|let||js|!-response.jsonbody[1].financialGoalType-!||
|let||js|!-response.jsonbody[1].dateNeeded.Date.year-!||
|let||js|!-response.jsonbody[1].dateNeeded.Date.month-!||
|let||js|!-response.jsonbody[1].dateNeeded.Date.day-!||
|let||js|!-response.jsonbody[1].dateNeeded.Date.displayValue-!||
|let||js|!-response.jsonbody[1].createdDate.Date.year-!||
|let||js|!-response.jsonbody[1].createdDate.Date.month-!||
|let||js|!-response.jsonbody[1].createdDate.Date.day-!||
|let||js|!-response.jsonbody[1].createdDate.Date.displayValue-!||
|let||js|!-response.jsonbody[1].financialGoalAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[1].financialGoalAmount.Money.precision-!||
|let||js|!-response.jsonbody[1].financialGoalAmount.Money.value-!||
|let||js|!-response.jsonbody[1].monthlyAmount.Money.currencyCode-!||
|let||js|!-response.jsonbody[1].monthlyAmount.Money.precision-!||
|let||js|!-response.jsonbody[1].monthlyAmount.Money.value-!||
|let||js|!-response.jsonbody[1].startAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[1].startAmount.Money.precision-!||
|let||js|!-response.jsonbody[1].startAmount.Money.value-!||
|let||js|!-response.jsonbody[1].rateOfReturn-!||
|let||js|!-response.jsonbody[1].retirementAge-!||
|let||js|!-response.jsonbody[1].monthlyRetirementAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[1].monthlyRetirementAmount.Money.precision-!||
|let||js|!-response.jsonbody[1].monthlyRetirementAmount.Money.value-!||
|let||js|!-response.jsonbody[1].inBudget-!||
|let||js|!-response.jsonbody[1].startDate.Date.year-!||
|let||js|!-response.jsonbody[1].startDate.Date.month-!||
|let||js|!-response.jsonbody[1].startDate.Date.day-!||
|let||js|!-response.jsonbody[1].startDate.Date.displayValue-!||
|let||js|!-response.jsonbody[1].dateOfBirth.Date.year-!||
|let||js|!-response.jsonbody[1].dateOfBirth.Date.month-!||
|let||js|!-response.jsonbody[1].dateOfBirth.Date.day-!||
|let||js|!-response.jsonbody[1].dateOfBirth.Date.displayValue-!||
|let||js|!-response.jsonbody[1].currentAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody[1].currentAmount.Money.precision-!||
|let||js|!-response.jsonbody[1].currentAmount.Money.value-!||
|let||js|!-response.jsonbody[1].percentComplete-!||
|let||js|!-response.jsonbody[1].saveNewGoal-!||
****!
!*****> '''1.3.3 GET FINANCIAL GOAL (/financialgoals//{goalId})'''

'''1.3.3.1 valid goalId'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|comment|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|GET|/%retirementFG1%|200|||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.id-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalName-!|!-updatedfinancialGoalName1-!|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalType-!|financial.goal.retirement|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.year-!|%yNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.month-!|%mNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.day-!|%dNeeded%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateNeeded.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.year-!|%todayYear%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.month-!|%todayMonth1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.day-!|%todayDay%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.createdDate.Date.displayValue-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAmount.Money.value-!|4000|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyAmount.Money.value-!|%monthlyAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startAmount.Money.value-!|%currentAmount%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.rateOfReturn-!|10|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.retirementAge-!|60|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.monthlyRetirementAmount.Money.value-!|470.42|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.inBudget-!|false|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.year-!|2012|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.month-!|12|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.day-!|10|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.startDate.Date.displayValue-!|12/10/2012|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.year-!|1986|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.month-!|11|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.day-!|11|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.dateOfBirth.Date.displayValue-!|11/11/1986|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.currencyCode-!|USD|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.precision-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.currentAmount.Money.value-!|%currentAmount2%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.percentComplete-!|%percentComplete%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.saveNewGoal-!|false|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.id-!||
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.financialGoalId-!|%retirementFG1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.userAccountJoinId-!|%userAccJoinID1%|
|let||js|!-response.jsonbody.FinancialGoalDetailItem.financialGoalAccounts[0].FinancialGoalAccount.percentage-!|15|

'''1.3.3.2 invalid goalId'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|GET|/123|400|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-ErrorCode: 200800 - Goal was not found for given goal id and user-!|true|

****!
****!
!*****> '''1.4 DELETE FINANCIAL GOAL'''
!*****> '''1.4.1 DELETE FINANCIAL GOAL ({baseurl}/financialgoals//{goalId})'''

'''1.4.1.1 different user deletes'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUserToken%|
|DELETE|/%retirementFG1%|403|||
|let|$errMsg|js|response.jsonbody.message||

!|com.lodosoftware.fitnesse.fixtures.LodosoftwareFixtures|
|symbolName|str|isContain?|
|errMsg|!-Security Error - ErrorCode: 20022 - User does not own this Financial Goal-!|true|

'''1.4.1.2 valid goalId'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|comment|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|DELETE|/%retirementFG1%|204|||
|DELETE|/%retirementFG2%|204|||
|DELETE|/%retirementFG3%|204|||
|DELETE|/%retirementFG4%|204|||
|DELETE|/%retirementFG5%|204|||
|DELETE|/%otherFG1%|204|||
|DELETE|/%fGoal3%|204|||
|DELETE|/%fGoal4%|204|||
|DELETE|/%fGoal5%|204|||

'''1.4.1.3 re-delete financial goal'''

|!-smartrics.rest.fitnesse.fixture.RestFixture-!|http://${serverName}/d3rest/financialgoals|
|setHeader|!- appKey : -!${institutionNum}!- 
Content-Type : application/json
userToken : -!%encodedUser2Token%|
|DELETE|/%retirementFG1%|204|||

****!
****!
!*****>  Clean-upTest Data

!|Execute|!-delete FROM [FINANCIAL_GOAL] where [FINANCIAL_GOAL_NAME] = 'thisfinancialGoalNameCreatedByFitTest3'-!|

!|Execute|!-delete from [USER_ACCOUNT_JOIN] where [ID] = -! @userAccJoinID1!-
            delete from [USER_ACCOUNT_JOIN] where [ID] = -! @userAccJoinID2!-
            delete from [OLB_ACCOUNT] where [ACCOUNT_ID] = -! @account1!-
            delete from [OLB_ACCOUNT] where [ACCOUNT_ID] = -! @account2|
!|DatabaseEnvironment|
|commit|
****!
****!